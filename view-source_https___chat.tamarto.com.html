
<!-- saved from url=(0025)https://chat.tamarto.com/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="color-scheme" content="light dark"></head><body><div class="line-gutter-backdrop"></div><form autocomplete="off"><label class="line-wrap-control">Line wrap<input type="checkbox" aria-label="Line wrap"></label></form><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-doctype">&lt;!DOCTYPE html&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><span class="html-tag">&lt;html <span class="html-attribute-name">lang</span>="<span class="html-attribute-value">en</span>"&gt;</span></td></tr><tr><td class="line-number" value="3"></td><td class="line-content"><span class="html-tag">&lt;head&gt;</span></td></tr><tr><td class="line-number" value="4"></td><td class="line-content">    <span class="html-tag">&lt;meta <span class="html-attribute-name">charset</span>="<span class="html-attribute-value">UTF-8</span>"&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content">    <span class="html-tag">&lt;meta <span class="html-attribute-name">name</span>="<span class="html-attribute-value">viewport</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">width=device-width, initial-scale=1.0</span>"&gt;</span></td></tr><tr><td class="line-number" value="6"></td><td class="line-content">    <span class="html-tag">&lt;title&gt;</span>Tamarto Secure Hub<span class="html-tag">&lt;/title&gt;</span></td></tr><tr><td class="line-number" value="7"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="8"></td><td class="line-content">    <span class="html-comment">&lt;!-- SECURITY: CSP allowing 'self' for your local scripts and WASM --&gt;</span></td></tr><tr><td class="line-number" value="9"></td><td class="line-content">    <span class="html-tag">&lt;meta <span class="html-attribute-name">http-equiv</span>="<span class="html-attribute-value">Content-Security-Policy</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value"><br></span></span></td></tr><tr><td class="line-number" value="10"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        default-src 'self';</span></span></td></tr><tr><td class="line-number" value="11"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        script-src 'self' 'unsafe-inline' 'unsafe-eval';</span></span></td></tr><tr><td class="line-number" value="12"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        style-src 'self' 'unsafe-inline';</span></span></td></tr><tr><td class="line-number" value="13"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        img-src 'self' https://chat.tamarto.com data:;</span></span></td></tr><tr><td class="line-number" value="14"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        connect-src 'self' https://node1.cabidge.com https://node2.cabidge.com https://node3.cabidge.com;</span></span></td></tr><tr><td class="line-number" value="15"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        font-src 'self';</span></span></td></tr><tr><td class="line-number" value="16"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        object-src 'none';</span></span></td></tr><tr><td class="line-number" value="17"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        base-uri 'self';</span></span></td></tr><tr><td class="line-number" value="18"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">        form-action 'self';</span></span></td></tr><tr><td class="line-number" value="19"></td><td class="line-content"><span class="html-tag"><span class="html-attribute-value">    </span>"&gt;</span></td></tr><tr><td class="line-number" value="20"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="21"></td><td class="line-content">    <span class="html-comment">&lt;!-- YOUR LOCAL SCRIPT REFERENCE --&gt;</span></td></tr><tr><td class="line-number" value="22"></td><td class="line-content">    <span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://chat.tamarto.com/js/argon2.js" rel="noreferrer noopener">/js/argon2.js</a>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">https://cdnjs.cloudflare.com/ajax/libs/argon2-browser/1.18.0/argon2-bundled.min.js</span>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="23"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="24"></td><td class="line-content">    <span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="25"></td><td class="line-content">        :root {</td></tr><tr><td class="line-number" value="26"></td><td class="line-content">            --primary-color: #075e54;</td></tr><tr><td class="line-number" value="27"></td><td class="line-content">            --secondary-color: #6c757d;</td></tr><tr><td class="line-number" value="28"></td><td class="line-content">            --danger-color: #dc3545;</td></tr><tr><td class="line-number" value="29"></td><td class="line-content">            --warning-color: #ffc107;</td></tr><tr><td class="line-number" value="30"></td><td class="line-content">            --light-bg: #e5ddd5;</td></tr><tr><td class="line-number" value="31"></td><td class="line-content">            --light-text: #212529;</td></tr><tr><td class="line-number" value="32"></td><td class="line-content">            --light-border: #dee2e6;</td></tr><tr><td class="line-number" value="33"></td><td class="line-content">            --light-card: #ffffff;</td></tr><tr><td class="line-number" value="34"></td><td class="line-content">            --sent-bg: #dcf8c6;</td></tr><tr><td class="line-number" value="35"></td><td class="line-content">            --received-bg: #f0f0f0;</td></tr><tr><td class="line-number" value="36"></td><td class="line-content">            --menu-bg: #ffffff;</td></tr><tr><td class="line-number" value="37"></td><td class="line-content">            --menu-hover: #f8f9fa;</td></tr><tr><td class="line-number" value="38"></td><td class="line-content">            --reaction-bg: #ffffff;</td></tr><tr><td class="line-number" value="39"></td><td class="line-content">            --reaction-border: #dadada;</td></tr><tr><td class="line-number" value="40"></td><td class="line-content">            --link-color: #039be5;</td></tr><tr><td class="line-number" value="41"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="42"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="43"></td><td class="line-content">        body.dark-mode {</td></tr><tr><td class="line-number" value="44"></td><td class="line-content">            --light-bg: #0f0f10;</td></tr><tr><td class="line-number" value="45"></td><td class="line-content">            --light-text: #f8f9fa;</td></tr><tr><td class="line-number" value="46"></td><td class="line-content">            --light-border: #495057;</td></tr><tr><td class="line-number" value="47"></td><td class="line-content">            --light-card: #1c1c1e;</td></tr><tr><td class="line-number" value="48"></td><td class="line-content">            --sent-bg: #056162;</td></tr><tr><td class="line-number" value="49"></td><td class="line-content">            --received-bg: #2a2a2c;</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">            --menu-bg: #2c2c2e;</td></tr><tr><td class="line-number" value="51"></td><td class="line-content">            --menu-hover: #3a3a3c;</td></tr><tr><td class="line-number" value="52"></td><td class="line-content">            --reaction-bg: #3a3a3c;</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">            --reaction-border: #555;</td></tr><tr><td class="line-number" value="54"></td><td class="line-content">            --link-color: #64b5f6;</td></tr><tr><td class="line-number" value="55"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="56"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="57"></td><td class="line-content">        *, *::before, *::after {</td></tr><tr><td class="line-number" value="58"></td><td class="line-content">            box-sizing: border-box;</td></tr><tr><td class="line-number" value="59"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="60"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="61"></td><td class="line-content">        body {</td></tr><tr><td class="line-number" value="62"></td><td class="line-content">            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;</td></tr><tr><td class="line-number" value="63"></td><td class="line-content">            margin: 0;</td></tr><tr><td class="line-number" value="64"></td><td class="line-content">            background-color: var(--light-bg);</td></tr><tr><td class="line-number" value="65"></td><td class="line-content">            color: var(--light-text);</td></tr><tr><td class="line-number" value="66"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="67"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="68"></td><td class="line-content">            justify-content: center;</td></tr><tr><td class="line-number" value="69"></td><td class="line-content">            min-height: 100vh;</td></tr><tr><td class="line-number" value="70"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="71"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="72"></td><td class="line-content">        .container {</td></tr><tr><td class="line-number" value="73"></td><td class="line-content">            max-width: 800px;</td></tr><tr><td class="line-number" value="74"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">            margin: 1rem;</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="77"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="78"></td><td class="line-content">        .header {</td></tr><tr><td class="line-number" value="79"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="80"></td><td class="line-content">            justify-content: space-between;</td></tr><tr><td class="line-number" value="81"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="82"></td><td class="line-content">            margin-bottom: 1.5rem;</td></tr><tr><td class="line-number" value="83"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="84"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="85"></td><td class="line-content">        .logo {</td></tr><tr><td class="line-number" value="86"></td><td class="line-content">            width: 48px;</td></tr><tr><td class="line-number" value="87"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="88"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="89"></td><td class="line-content">        /* BACK BUTTON STYLE */</td></tr><tr><td class="line-number" value="90"></td><td class="line-content">        #back-to-lobby-btn {</td></tr><tr><td class="line-number" value="91"></td><td class="line-content">            background-color: var(--secondary-color);</td></tr><tr><td class="line-number" value="92"></td><td class="line-content">            color: white;</td></tr><tr><td class="line-number" value="93"></td><td class="line-content">            padding: 8px 16px;</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">            font-size: 0.9rem;</td></tr><tr><td class="line-number" value="95"></td><td class="line-content">            border-radius: 20px;</td></tr><tr><td class="line-number" value="96"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="97"></td><td class="line-content">            box-shadow: 0 2px 4px rgba(0,0,0,0.1);</td></tr><tr><td class="line-number" value="98"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="99"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="100"></td><td class="line-content">        .card {</td></tr><tr><td class="line-number" value="101"></td><td class="line-content">            padding: 1.5rem;</td></tr><tr><td class="line-number" value="102"></td><td class="line-content">            background-color: var(--light-card);</td></tr><tr><td class="line-number" value="103"></td><td class="line-content">            border: 1px solid var(--light-border);</td></tr><tr><td class="line-number" value="104"></td><td class="line-content">            border-radius: 8px;</td></tr><tr><td class="line-number" value="105"></td><td class="line-content">            box-shadow: 0 4px 12px rgba(0,0,0,0.08);</td></tr><tr><td class="line-number" value="106"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="107"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="108"></td><td class="line-content">        input {</td></tr><tr><td class="line-number" value="109"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="110"></td><td class="line-content">            padding: 0.75rem;</td></tr><tr><td class="line-number" value="111"></td><td class="line-content">            border: 1px solid var(--light-border);</td></tr><tr><td class="line-number" value="112"></td><td class="line-content">            border-radius: 4px;</td></tr><tr><td class="line-number" value="113"></td><td class="line-content">            background-color: var(--light-card);</td></tr><tr><td class="line-number" value="114"></td><td class="line-content">            color: var(--light-text);</td></tr><tr><td class="line-number" value="115"></td><td class="line-content">            font-size: 1rem;</td></tr><tr><td class="line-number" value="116"></td><td class="line-content">            margin-bottom: 1rem;</td></tr><tr><td class="line-number" value="117"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="118"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="119"></td><td class="line-content">        button {</td></tr><tr><td class="line-number" value="120"></td><td class="line-content">            padding: 0.75rem 1.5rem;</td></tr><tr><td class="line-number" value="121"></td><td class="line-content">            border: none;</td></tr><tr><td class="line-number" value="122"></td><td class="line-content">            border-radius: 4px;</td></tr><tr><td class="line-number" value="123"></td><td class="line-content">            background-color: var(--primary-color);</td></tr><tr><td class="line-number" value="124"></td><td class="line-content">            color: white;</td></tr><tr><td class="line-number" value="125"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="126"></td><td class="line-content">            font-size: 1rem;</td></tr><tr><td class="line-number" value="127"></td><td class="line-content">            font-weight: 500;</td></tr><tr><td class="line-number" value="128"></td><td class="line-content">            transition: opacity 0.2s;</td></tr><tr><td class="line-number" value="129"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="130"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="131"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="132"></td><td class="line-content">            button:hover {</td></tr><tr><td class="line-number" value="133"></td><td class="line-content">                opacity: 0.9;</td></tr><tr><td class="line-number" value="134"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="135"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="136"></td><td class="line-content">            button.danger {</td></tr><tr><td class="line-number" value="137"></td><td class="line-content">                background-color: var(--danger-color);</td></tr><tr><td class="line-number" value="138"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="139"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="140"></td><td class="line-content">            button.secondary {</td></tr><tr><td class="line-number" value="141"></td><td class="line-content">                background-color: var(--secondary-color);</td></tr><tr><td class="line-number" value="142"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="143"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="144"></td><td class="line-content">        .icon-btn {</td></tr><tr><td class="line-number" value="145"></td><td class="line-content">            background: transparent;</td></tr><tr><td class="line-number" value="146"></td><td class="line-content">            padding: 0.5rem;</td></tr><tr><td class="line-number" value="147"></td><td class="line-content">            border-radius: 50%;</td></tr><tr><td class="line-number" value="148"></td><td class="line-content">            display: inline-flex;</td></tr><tr><td class="line-number" value="149"></td><td class="line-content">            width: auto;</td></tr><tr><td class="line-number" value="150"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="151"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="152"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="153"></td><td class="line-content">            .icon-btn svg {</td></tr><tr><td class="line-number" value="154"></td><td class="line-content">                width: 24px;</td></tr><tr><td class="line-number" value="155"></td><td class="line-content">                height: 24px;</td></tr><tr><td class="line-number" value="156"></td><td class="line-content">                stroke: var(--light-text);</td></tr><tr><td class="line-number" value="157"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="158"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="159"></td><td class="line-content">        /* LOBBY STYLES */</td></tr><tr><td class="line-number" value="160"></td><td class="line-content">        .chat-list-item {</td></tr><tr><td class="line-number" value="161"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="162"></td><td class="line-content">            justify-content: space-between;</td></tr><tr><td class="line-number" value="163"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="164"></td><td class="line-content">            padding: 15px;</td></tr><tr><td class="line-number" value="165"></td><td class="line-content">            border: 1px solid var(--light-border);</td></tr><tr><td class="line-number" value="166"></td><td class="line-content">            border-radius: 8px;</td></tr><tr><td class="line-number" value="167"></td><td class="line-content">            margin-bottom: 10px;</td></tr><tr><td class="line-number" value="168"></td><td class="line-content">            background-color: var(--menu-bg);</td></tr><tr><td class="line-number" value="169"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="170"></td><td class="line-content">            transition: transform 0.1s;</td></tr><tr><td class="line-number" value="171"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="172"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="173"></td><td class="line-content">            .chat-list-item:hover {</td></tr><tr><td class="line-number" value="174"></td><td class="line-content">                transform: scale(1.01);</td></tr><tr><td class="line-number" value="175"></td><td class="line-content">                border-color: var(--primary-color);</td></tr><tr><td class="line-number" value="176"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="177"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="178"></td><td class="line-content">        /* CHAT STYLES */</td></tr><tr><td class="line-number" value="179"></td><td class="line-content">        #chat-app {</td></tr><tr><td class="line-number" value="180"></td><td class="line-content">            display: none;</td></tr><tr><td class="line-number" value="181"></td><td class="line-content">            flex-direction: column;</td></tr><tr><td class="line-number" value="182"></td><td class="line-content">            height: 80vh;</td></tr><tr><td class="line-number" value="183"></td><td class="line-content">            max-height: 800px;</td></tr><tr><td class="line-number" value="184"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="185"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="186"></td><td class="line-content">        #chat-header {</td></tr><tr><td class="line-number" value="187"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="188"></td><td class="line-content">            justify-content: space-between;</td></tr><tr><td class="line-number" value="189"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="190"></td><td class="line-content">            padding-bottom: 1rem;</td></tr><tr><td class="line-number" value="191"></td><td class="line-content">            border-bottom: 1px solid var(--light-border);</td></tr><tr><td class="line-number" value="192"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="193"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="194"></td><td class="line-content">        .header-info {</td></tr><tr><td class="line-number" value="195"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="196"></td><td class="line-content">            flex-direction: column;</td></tr><tr><td class="line-number" value="197"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="198"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="199"></td><td class="line-content">        /* TIMER STYLES */</td></tr><tr><td class="line-number" value="200"></td><td class="line-content">        .expiry-timer {</td></tr><tr><td class="line-number" value="201"></td><td class="line-content">            font-family: monospace;</td></tr><tr><td class="line-number" value="202"></td><td class="line-content">            font-weight: bold;</td></tr><tr><td class="line-number" value="203"></td><td class="line-content">            font-size: 0.9rem;</td></tr><tr><td class="line-number" value="204"></td><td class="line-content">            padding: 2px 8px;</td></tr><tr><td class="line-number" value="205"></td><td class="line-content">            border-radius: 4px;</td></tr><tr><td class="line-number" value="206"></td><td class="line-content">            background: var(--received-bg);</td></tr><tr><td class="line-number" value="207"></td><td class="line-content">            color: var(--primary-color);</td></tr><tr><td class="line-number" value="208"></td><td class="line-content">            display: inline-block;</td></tr><tr><td class="line-number" value="209"></td><td class="line-content">            margin-top: 4px;</td></tr><tr><td class="line-number" value="210"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="211"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="212"></td><td class="line-content">            .expiry-timer.warning {</td></tr><tr><td class="line-number" value="213"></td><td class="line-content">                color: #d68e00;</td></tr><tr><td class="line-number" value="214"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="215"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="216"></td><td class="line-content">            .expiry-timer.critical {</td></tr><tr><td class="line-number" value="217"></td><td class="line-content">                color: var(--danger-color);</td></tr><tr><td class="line-number" value="218"></td><td class="line-content">                animation: pulse 2s infinite;</td></tr><tr><td class="line-number" value="219"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="220"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="221"></td><td class="line-content">        @keyframes pulse {</td></tr><tr><td class="line-number" value="222"></td><td class="line-content">            0% {</td></tr><tr><td class="line-number" value="223"></td><td class="line-content">                opacity: 1;</td></tr><tr><td class="line-number" value="224"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="225"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="226"></td><td class="line-content">            50% {</td></tr><tr><td class="line-number" value="227"></td><td class="line-content">                opacity: 0.5;</td></tr><tr><td class="line-number" value="228"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="229"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="230"></td><td class="line-content">            100% {</td></tr><tr><td class="line-number" value="231"></td><td class="line-content">                opacity: 1;</td></tr><tr><td class="line-number" value="232"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="233"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="234"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="235"></td><td class="line-content">        .header-actions {</td></tr><tr><td class="line-number" value="236"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="237"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="238"></td><td class="line-content">            gap: 5px;</td></tr><tr><td class="line-number" value="239"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="240"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="241"></td><td class="line-content">        .chat-messages-container {</td></tr><tr><td class="line-number" value="242"></td><td class="line-content">            flex-grow: 1;</td></tr><tr><td class="line-number" value="243"></td><td class="line-content">            overflow-y: auto;</td></tr><tr><td class="line-number" value="244"></td><td class="line-content">            padding: 1rem 0;</td></tr><tr><td class="line-number" value="245"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="246"></td><td class="line-content">            flex-direction: column;</td></tr><tr><td class="line-number" value="247"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="248"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="249"></td><td class="line-content">        .messages-wrapper {</td></tr><tr><td class="line-number" value="250"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="251"></td><td class="line-content">            flex-direction: column;</td></tr><tr><td class="line-number" value="252"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="253"></td><td class="line-content">            padding: 0 10px;</td></tr><tr><td class="line-number" value="254"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="255"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="256"></td><td class="line-content">        .message-bubble {</td></tr><tr><td class="line-number" value="257"></td><td class="line-content">            max-width: 70%;</td></tr><tr><td class="line-number" value="258"></td><td class="line-content">            padding: 10px 15px;</td></tr><tr><td class="line-number" value="259"></td><td class="line-content">            border-radius: 8px;</td></tr><tr><td class="line-number" value="260"></td><td class="line-content">            margin-bottom: 14px;</td></tr><tr><td class="line-number" value="261"></td><td class="line-content">            line-height: 1.4;</td></tr><tr><td class="line-number" value="262"></td><td class="line-content">            word-wrap: break-word;</td></tr><tr><td class="line-number" value="263"></td><td class="line-content">            box-shadow: 0 1px 1px rgba(0,0,0,0.1);</td></tr><tr><td class="line-number" value="264"></td><td class="line-content">            position: relative;</td></tr><tr><td class="line-number" value="265"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="266"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="267"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="268"></td><td class="line-content">            .message-bubble.sent {</td></tr><tr><td class="line-number" value="269"></td><td class="line-content">                background-color: var(--sent-bg);</td></tr><tr><td class="line-number" value="270"></td><td class="line-content">                align-self: flex-end;</td></tr><tr><td class="line-number" value="271"></td><td class="line-content">                border-top-right-radius: 0;</td></tr><tr><td class="line-number" value="272"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="273"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="274"></td><td class="line-content">            .message-bubble.received {</td></tr><tr><td class="line-number" value="275"></td><td class="line-content">                background-color: var(--received-bg);</td></tr><tr><td class="line-number" value="276"></td><td class="line-content">                align-self: flex-start;</td></tr><tr><td class="line-number" value="277"></td><td class="line-content">                border-top-left-radius: 0;</td></tr><tr><td class="line-number" value="278"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="279"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="280"></td><td class="line-content">            .message-bubble a {</td></tr><tr><td class="line-number" value="281"></td><td class="line-content">                color: var(--link-color);</td></tr><tr><td class="line-number" value="282"></td><td class="line-content">                text-decoration: underline;</td></tr><tr><td class="line-number" value="283"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="284"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="285"></td><td class="line-content">        .message-meta {</td></tr><tr><td class="line-number" value="286"></td><td class="line-content">            font-size: 0.7rem;</td></tr><tr><td class="line-number" value="287"></td><td class="line-content">            color: var(--secondary-color);</td></tr><tr><td class="line-number" value="288"></td><td class="line-content">            margin-bottom: 2px;</td></tr><tr><td class="line-number" value="289"></td><td class="line-content">            font-weight: 600;</td></tr><tr><td class="line-number" value="290"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="291"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="292"></td><td class="line-content">        .message-time {</td></tr><tr><td class="line-number" value="293"></td><td class="line-content">            font-size: 0.65rem;</td></tr><tr><td class="line-number" value="294"></td><td class="line-content">            color: var(--secondary-color);</td></tr><tr><td class="line-number" value="295"></td><td class="line-content">            float: right;</td></tr><tr><td class="line-number" value="296"></td><td class="line-content">            margin-top: 5px;</td></tr><tr><td class="line-number" value="297"></td><td class="line-content">            margin-left: 10px;</td></tr><tr><td class="line-number" value="298"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="299"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="300"></td><td class="line-content">        /* REACTION PILLS */</td></tr><tr><td class="line-number" value="301"></td><td class="line-content">        .reaction-container {</td></tr><tr><td class="line-number" value="302"></td><td class="line-content">            position: absolute;</td></tr><tr><td class="line-number" value="303"></td><td class="line-content">            bottom: -10px;</td></tr><tr><td class="line-number" value="304"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="305"></td><td class="line-content">            gap: 2px;</td></tr><tr><td class="line-number" value="306"></td><td class="line-content">            z-index: 1;</td></tr><tr><td class="line-number" value="307"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="308"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="309"></td><td class="line-content">        .message-bubble.sent .reaction-container {</td></tr><tr><td class="line-number" value="310"></td><td class="line-content">            right: 10px;</td></tr><tr><td class="line-number" value="311"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="312"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="313"></td><td class="line-content">        .message-bubble.received .reaction-container {</td></tr><tr><td class="line-number" value="314"></td><td class="line-content">            left: 10px;</td></tr><tr><td class="line-number" value="315"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="316"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="317"></td><td class="line-content">        .reaction-pill {</td></tr><tr><td class="line-number" value="318"></td><td class="line-content">            background-color: var(--reaction-bg);</td></tr><tr><td class="line-number" value="319"></td><td class="line-content">            border: 1px solid var(--reaction-border);</td></tr><tr><td class="line-number" value="320"></td><td class="line-content">            border-radius: 10px;</td></tr><tr><td class="line-number" value="321"></td><td class="line-content">            padding: 2px 5px;</td></tr><tr><td class="line-number" value="322"></td><td class="line-content">            font-size: 0.75rem;</td></tr><tr><td class="line-number" value="323"></td><td class="line-content">            box-shadow: 0 1px 2px rgba(0,0,0,0.15);</td></tr><tr><td class="line-number" value="324"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="325"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="326"></td><td class="line-content">            gap: 2px;</td></tr><tr><td class="line-number" value="327"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="328"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="329"></td><td class="line-content">        #chat-form {</td></tr><tr><td class="line-number" value="330"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="331"></td><td class="line-content">            gap: 10px;</td></tr><tr><td class="line-number" value="332"></td><td class="line-content">            border-top: 1px solid var(--light-border);</td></tr><tr><td class="line-number" value="333"></td><td class="line-content">            padding-top: 1rem;</td></tr><tr><td class="line-number" value="334"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="335"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="336"></td><td class="line-content">            #chat-form input {</td></tr><tr><td class="line-number" value="337"></td><td class="line-content">                margin-bottom: 0;</td></tr><tr><td class="line-number" value="338"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="339"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="340"></td><td class="line-content">            #chat-form button {</td></tr><tr><td class="line-number" value="341"></td><td class="line-content">                width: auto;</td></tr><tr><td class="line-number" value="342"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="343"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="344"></td><td class="line-content">        .status-indicator {</td></tr><tr><td class="line-number" value="345"></td><td class="line-content">            font-size: 0.85rem;</td></tr><tr><td class="line-number" value="346"></td><td class="line-content">            color: var(--secondary-color);</td></tr><tr><td class="line-number" value="347"></td><td class="line-content">            text-align: center;</td></tr><tr><td class="line-number" value="348"></td><td class="line-content">            margin-top: 0.5rem;</td></tr><tr><td class="line-number" value="349"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="350"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="351"></td><td class="line-content">        /* BURGER MENU */</td></tr><tr><td class="line-number" value="352"></td><td class="line-content">        .burger-menu-container {</td></tr><tr><td class="line-number" value="353"></td><td class="line-content">            position: relative;</td></tr><tr><td class="line-number" value="354"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="355"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="356"></td><td class="line-content">        .menu-dropdown {</td></tr><tr><td class="line-number" value="357"></td><td class="line-content">            display: none;</td></tr><tr><td class="line-number" value="358"></td><td class="line-content">            position: absolute;</td></tr><tr><td class="line-number" value="359"></td><td class="line-content">            right: 0;</td></tr><tr><td class="line-number" value="360"></td><td class="line-content">            top: 100%;</td></tr><tr><td class="line-number" value="361"></td><td class="line-content">            background-color: var(--menu-bg);</td></tr><tr><td class="line-number" value="362"></td><td class="line-content">            border: 1px solid var(--light-border);</td></tr><tr><td class="line-number" value="363"></td><td class="line-content">            border-radius: 4px;</td></tr><tr><td class="line-number" value="364"></td><td class="line-content">            box-shadow: 0 4px 12px rgba(0,0,0,0.15);</td></tr><tr><td class="line-number" value="365"></td><td class="line-content">            min-width: 180px;</td></tr><tr><td class="line-number" value="366"></td><td class="line-content">            z-index: 100;</td></tr><tr><td class="line-number" value="367"></td><td class="line-content">            flex-direction: column;</td></tr><tr><td class="line-number" value="368"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="369"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="370"></td><td class="line-content">            .menu-dropdown.show {</td></tr><tr><td class="line-number" value="371"></td><td class="line-content">                display: flex;</td></tr><tr><td class="line-number" value="372"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="373"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="374"></td><td class="line-content">        .menu-item {</td></tr><tr><td class="line-number" value="375"></td><td class="line-content">            padding: 10px 15px;</td></tr><tr><td class="line-number" value="376"></td><td class="line-content">            color: var(--light-text);</td></tr><tr><td class="line-number" value="377"></td><td class="line-content">            text-align: left;</td></tr><tr><td class="line-number" value="378"></td><td class="line-content">            border: none;</td></tr><tr><td class="line-number" value="379"></td><td class="line-content">            background: none;</td></tr><tr><td class="line-number" value="380"></td><td class="line-content">            border-bottom: 1px solid var(--light-border);</td></tr><tr><td class="line-number" value="381"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="382"></td><td class="line-content">            font-size: 0.9rem;</td></tr><tr><td class="line-number" value="383"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="384"></td><td class="line-content">            text-decoration: none;</td></tr><tr><td class="line-number" value="385"></td><td class="line-content">            display: block;</td></tr><tr><td class="line-number" value="386"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="387"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="388"></td><td class="line-content">            .menu-item:hover {</td></tr><tr><td class="line-number" value="389"></td><td class="line-content">                background-color: var(--menu-hover);</td></tr><tr><td class="line-number" value="390"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="391"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="392"></td><td class="line-content">        /* MODALS */</td></tr><tr><td class="line-number" value="393"></td><td class="line-content">        .modal-overlay {</td></tr><tr><td class="line-number" value="394"></td><td class="line-content">            position: fixed;</td></tr><tr><td class="line-number" value="395"></td><td class="line-content">            top: 0;</td></tr><tr><td class="line-number" value="396"></td><td class="line-content">            left: 0;</td></tr><tr><td class="line-number" value="397"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="398"></td><td class="line-content">            height: 100%;</td></tr><tr><td class="line-number" value="399"></td><td class="line-content">            background-color: rgba(0,0,0,0.5);</td></tr><tr><td class="line-number" value="400"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="401"></td><td class="line-content">            justify-content: center;</td></tr><tr><td class="line-number" value="402"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="403"></td><td class="line-content">            z-index: 1000;</td></tr><tr><td class="line-number" value="404"></td><td class="line-content">            backdrop-filter: blur(2px);</td></tr><tr><td class="line-number" value="405"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="406"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="407"></td><td class="line-content">        .modal-content {</td></tr><tr><td class="line-number" value="408"></td><td class="line-content">            background-color: var(--light-card);</td></tr><tr><td class="line-number" value="409"></td><td class="line-content">            padding: 2rem;</td></tr><tr><td class="line-number" value="410"></td><td class="line-content">            border-radius: 8px;</td></tr><tr><td class="line-number" value="411"></td><td class="line-content">            max-width: 400px;</td></tr><tr><td class="line-number" value="412"></td><td class="line-content">            width: 90%;</td></tr><tr><td class="line-number" value="413"></td><td class="line-content">            text-align: center;</td></tr><tr><td class="line-number" value="414"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="415"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="416"></td><td class="line-content">        .modal-actions {</td></tr><tr><td class="line-number" value="417"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="418"></td><td class="line-content">            justify-content: center;</td></tr><tr><td class="line-number" value="419"></td><td class="line-content">            gap: 1rem;</td></tr><tr><td class="line-number" value="420"></td><td class="line-content">            margin-top: 1.5rem;</td></tr><tr><td class="line-number" value="421"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="422"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="423"></td><td class="line-content">        /* MESSAGE OPTIONS MENU */</td></tr><tr><td class="line-number" value="424"></td><td class="line-content">        #message-options-modal {</td></tr><tr><td class="line-number" value="425"></td><td class="line-content">            display: none;</td></tr><tr><td class="line-number" value="426"></td><td class="line-content">            position: fixed;</td></tr><tr><td class="line-number" value="427"></td><td class="line-content">            top: 0;</td></tr><tr><td class="line-number" value="428"></td><td class="line-content">            left: 0;</td></tr><tr><td class="line-number" value="429"></td><td class="line-content">            width: 100%;</td></tr><tr><td class="line-number" value="430"></td><td class="line-content">            height: 100%;</td></tr><tr><td class="line-number" value="431"></td><td class="line-content">            background: rgba(0,0,0,0.4);</td></tr><tr><td class="line-number" value="432"></td><td class="line-content">            z-index: 2000;</td></tr><tr><td class="line-number" value="433"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="434"></td><td class="line-content">            justify-content: center;</td></tr><tr><td class="line-number" value="435"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="436"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="437"></td><td class="line-content">        .message-options-bar {</td></tr><tr><td class="line-number" value="438"></td><td class="line-content">            background: var(--light-card);</td></tr><tr><td class="line-number" value="439"></td><td class="line-content">            padding: 15px;</td></tr><tr><td class="line-number" value="440"></td><td class="line-content">            border-radius: 50px;</td></tr><tr><td class="line-number" value="441"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="442"></td><td class="line-content">            gap: 15px;</td></tr><tr><td class="line-number" value="443"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="444"></td><td class="line-content">            box-shadow: 0 4px 15px rgba(0,0,0,0.2);</td></tr><tr><td class="line-number" value="445"></td><td class="line-content">            animation: popIn 0.2s ease-out;</td></tr><tr><td class="line-number" value="446"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="447"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="448"></td><td class="line-content">        .emoji-opt {</td></tr><tr><td class="line-number" value="449"></td><td class="line-content">            font-size: 1.5rem;</td></tr><tr><td class="line-number" value="450"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="451"></td><td class="line-content">            transition: transform 0.1s;</td></tr><tr><td class="line-number" value="452"></td><td class="line-content">            background: none;</td></tr><tr><td class="line-number" value="453"></td><td class="line-content">            border: none;</td></tr><tr><td class="line-number" value="454"></td><td class="line-content">            padding: 0;</td></tr><tr><td class="line-number" value="455"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="456"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="457"></td><td class="line-content">            .emoji-opt:hover {</td></tr><tr><td class="line-number" value="458"></td><td class="line-content">                transform: scale(1.3);</td></tr><tr><td class="line-number" value="459"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="460"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="461"></td><td class="line-content">        .delete-opt-btn {</td></tr><tr><td class="line-number" value="462"></td><td class="line-content">            background: var(--danger-color);</td></tr><tr><td class="line-number" value="463"></td><td class="line-content">            color: white;</td></tr><tr><td class="line-number" value="464"></td><td class="line-content">            border: none;</td></tr><tr><td class="line-number" value="465"></td><td class="line-content">            border-radius: 50%;</td></tr><tr><td class="line-number" value="466"></td><td class="line-content">            width: 36px;</td></tr><tr><td class="line-number" value="467"></td><td class="line-content">            height: 36px;</td></tr><tr><td class="line-number" value="468"></td><td class="line-content">            display: flex;</td></tr><tr><td class="line-number" value="469"></td><td class="line-content">            align-items: center;</td></tr><tr><td class="line-number" value="470"></td><td class="line-content">            justify-content: center;</td></tr><tr><td class="line-number" value="471"></td><td class="line-content">            cursor: pointer;</td></tr><tr><td class="line-number" value="472"></td><td class="line-content">            margin-left: 10px;</td></tr><tr><td class="line-number" value="473"></td><td class="line-content">            padding: 0;</td></tr><tr><td class="line-number" value="474"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="475"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="476"></td><td class="line-content">            .delete-opt-btn svg {</td></tr><tr><td class="line-number" value="477"></td><td class="line-content">                width: 18px;</td></tr><tr><td class="line-number" value="478"></td><td class="line-content">                height: 18px;</td></tr><tr><td class="line-number" value="479"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="480"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="481"></td><td class="line-content">        @keyframes popIn {</td></tr><tr><td class="line-number" value="482"></td><td class="line-content">            from {</td></tr><tr><td class="line-number" value="483"></td><td class="line-content">                opacity: 0;</td></tr><tr><td class="line-number" value="484"></td><td class="line-content">                transform: scale(0.8);</td></tr><tr><td class="line-number" value="485"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="486"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="487"></td><td class="line-content">            to {</td></tr><tr><td class="line-number" value="488"></td><td class="line-content">                opacity: 1;</td></tr><tr><td class="line-number" value="489"></td><td class="line-content">                transform: scale(1);</td></tr><tr><td class="line-number" value="490"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="491"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="492"></td><td class="line-content">    <span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="493"></td><td class="line-content"><span class="html-tag">&lt;/head&gt;</span></td></tr><tr><td class="line-number" value="494"></td><td class="line-content"><span class="html-tag">&lt;body&gt;</span></td></tr><tr><td class="line-number" value="495"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">container</span>"&gt;</span></td></tr><tr><td class="line-number" value="496"></td><td class="line-content">        <span class="html-comment">&lt;!-- MAIN HEADER (Top of Screen) --&gt;</span></td></tr><tr><td class="line-number" value="497"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">header</span>"&gt;</span></td></tr><tr><td class="line-number" value="498"></td><td class="line-content">            <span class="html-tag">&lt;img <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://chat.tamarto.com/icons/icon-48.png" rel="noreferrer noopener">https://chat.tamarto.com/icons/icon-48.png</a>" <span class="html-attribute-name">alt</span>="<span class="html-attribute-value">Logo</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">logo</span>"&gt;</span></td></tr><tr><td class="line-number" value="499"></td><td class="line-content">            <span class="html-comment">&lt;!-- Navigation Button: Top Left --&gt;</span></td></tr><tr><td class="line-number" value="500"></td><td class="line-content">            <span class="html-tag">&lt;button <span class="html-attribute-name">id</span>="<span class="html-attribute-value">back-to-lobby-btn</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">display: none;</span>"&gt;</span></td></tr><tr><td class="line-number" value="501"></td><td class="line-content">                 My Chats</td></tr><tr><td class="line-number" value="502"></td><td class="line-content">            <span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="503"></td><td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="504"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="505"></td><td class="line-content">        <span class="html-comment">&lt;!-- 1. UNLOCK --&gt;</span></td></tr><tr><td class="line-number" value="506"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">unlock-container</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>"&gt;</span></td></tr><tr><td class="line-number" value="507"></td><td class="line-content">            <span class="html-tag">&lt;h1&gt;</span>Secure Hub<span class="html-tag">&lt;/h1&gt;</span></td></tr><tr><td class="line-number" value="508"></td><td class="line-content">            <span class="html-tag">&lt;p&gt;</span>Enter Master Password.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="509"></td><td class="line-content">            <span class="html-tag">&lt;form <span class="html-attribute-name">id</span>="<span class="html-attribute-value">unlock-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="510"></td><td class="line-content">                <span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">password</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">master-password</span>" <span class="html-attribute-name">placeholder</span>="<span class="html-attribute-value">Master Password</span>" <span class="html-attribute-name">autocomplete</span>="<span class="html-attribute-value">current-password</span>"&gt;</span></td></tr><tr><td class="line-number" value="511"></td><td class="line-content">                <span class="html-tag">&lt;button <span class="html-attribute-name">type</span>="<span class="html-attribute-value">submit</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">unlock-btn</span>"&gt;</span>Unlock Hub<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="512"></td><td class="line-content">            <span class="html-tag">&lt;/form&gt;</span></td></tr><tr><td class="line-number" value="513"></td><td class="line-content">            <span class="html-tag">&lt;p <span class="html-attribute-name">id</span>="<span class="html-attribute-value">unlock-message</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">status-indicator</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">color: var(--danger-color);</span>"&gt;</span><span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="514"></td><td class="line-content">            <span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">status-indicator</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">connection-status</span>"&gt;</span>Checking connection...<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="515"></td><td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="516"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="517"></td><td class="line-content">        <span class="html-comment">&lt;!-- 2. LOBBY --&gt;</span></td></tr><tr><td class="line-number" value="518"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">lobby-container</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">display: none;</span>"&gt;</span></td></tr><tr><td class="line-number" value="519"></td><td class="line-content">            <span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">display:flex; justify-content:space-between; align-items:center; margin-bottom: 1rem;</span>"&gt;</span></td></tr><tr><td class="line-number" value="520"></td><td class="line-content">                <span class="html-tag">&lt;h2&gt;</span>My Chats<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="521"></td><td class="line-content">                <span class="html-tag">&lt;button <span class="html-attribute-name">id</span>="<span class="html-attribute-value">open-create-modal-btn</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width: auto;</span>"&gt;</span>+ New<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="522"></td><td class="line-content">            <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="523"></td><td class="line-content">            <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chat-list-container</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">min-height: 100px;</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="524"></td><td class="line-content">            <span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border-top: 1px solid var(--light-border); padding-top: 1rem; margin-top: 1rem;</span>"&gt;</span></td></tr><tr><td class="line-number" value="525"></td><td class="line-content">                <span class="html-tag">&lt;h3&gt;</span>Join Existing Chat<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="526"></td><td class="line-content">                <span class="html-tag">&lt;form <span class="html-attribute-name">id</span>="<span class="html-attribute-value">join-chat-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="527"></td><td class="line-content">                    <span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">join-id-input</span>" <span class="html-attribute-name">placeholder</span>="<span class="html-attribute-value">Chat ID / Link</span>" <span class="html-attribute-name">autocomplete</span>="<span class="html-attribute-value">off</span>"&gt;</span></td></tr><tr><td class="line-number" value="528"></td><td class="line-content">                    <span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">password</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">join-pass-input</span>" <span class="html-attribute-name">placeholder</span>="<span class="html-attribute-value">Chat Password</span>" <span class="html-attribute-name">autocomplete</span>="<span class="html-attribute-value">off</span>"&gt;</span></td></tr><tr><td class="line-number" value="529"></td><td class="line-content">                    <span class="html-tag">&lt;button <span class="html-attribute-name">type</span>="<span class="html-attribute-value">submit</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">join-btn</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">secondary</span>"&gt;</span>Join &amp; Save<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="530"></td><td class="line-content">                <span class="html-tag">&lt;/form&gt;</span></td></tr><tr><td class="line-number" value="531"></td><td class="line-content">            <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="532"></td><td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="533"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="534"></td><td class="line-content">        <span class="html-comment">&lt;!-- 3. CHAT ROOM --&gt;</span></td></tr><tr><td class="line-number" value="535"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chat-app</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">card</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">display: none;</span>"&gt;</span></td></tr><tr><td class="line-number" value="536"></td><td class="line-content">            <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">handle-container</span>"&gt;</span></td></tr><tr><td class="line-number" value="537"></td><td class="line-content">                <span class="html-tag">&lt;h2&gt;</span>Chat Identity<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="538"></td><td class="line-content">                <span class="html-tag">&lt;p&gt;</span>Choose a display name.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="539"></td><td class="line-content">                <span class="html-tag">&lt;form <span class="html-attribute-name">id</span>="<span class="html-attribute-value">handle-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="540"></td><td class="line-content">                    <span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">handle-input</span>" <span class="html-attribute-name">placeholder</span>="<span class="html-attribute-value">@your-name</span>" <span class="html-attribute-name">autocomplete</span>="<span class="html-attribute-value">nickname</span>"&gt;</span></td></tr><tr><td class="line-number" value="541"></td><td class="line-content">                    <span class="html-tag">&lt;button <span class="html-attribute-name">type</span>="<span class="html-attribute-value">submit</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">set-handle-btn</span>"&gt;</span>Enter Room<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="542"></td><td class="line-content">                <span class="html-tag">&lt;/form&gt;</span></td></tr><tr><td class="line-number" value="543"></td><td class="line-content">            <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="544"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="545"></td><td class="line-content">            <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chat-container</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">display: none; flex-direction: column; height: 100%;</span>"&gt;</span></td></tr><tr><td class="line-number" value="546"></td><td class="line-content">                <span class="html-comment">&lt;!-- CHAT HEADER (Top of Chat Card) --&gt;</span></td></tr><tr><td class="line-number" value="547"></td><td class="line-content">                <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chat-header</span>"&gt;</span></td></tr><tr><td class="line-number" value="548"></td><td class="line-content">                    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">header-info</span>"&gt;</span></td></tr><tr><td class="line-number" value="549"></td><td class="line-content">                        <span class="html-tag">&lt;h2 <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chat-title-display</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin:0; font-size: 1.2rem;</span>"&gt;</span>Chat<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="550"></td><td class="line-content">                        <span class="html-tag">&lt;small <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chat-id-display</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">cursor:pointer;</span>" <span class="html-attribute-name">title</span>="<span class="html-attribute-value">Click to copy</span>"&gt;</span>ID: ...<span class="html-tag">&lt;/small&gt;</span></td></tr><tr><td class="line-number" value="551"></td><td class="line-content">                        <span class="html-tag">&lt;span <span class="html-attribute-name">id</span>="<span class="html-attribute-value">expiry-timer</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">expiry-timer</span>"&gt;</span>30:00<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="552"></td><td class="line-content">                    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="553"></td><td class="line-content">                    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">header-actions</span>"&gt;</span></td></tr><tr><td class="line-number" value="554"></td><td class="line-content">                        <span class="html-comment">&lt;!-- Delete Button --&gt;</span></td></tr><tr><td class="line-number" value="555"></td><td class="line-content">                        <span class="html-tag">&lt;button <span class="html-attribute-name">id</span>="<span class="html-attribute-value">delete-chat-btn</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">icon-btn danger</span>" <span class="html-attribute-name">title</span>="<span class="html-attribute-value">Delete Chat</span>"&gt;</span></td></tr><tr><td class="line-number" value="556"></td><td class="line-content">                            <span class="html-tag">&lt;svg <span class="html-attribute-name">fill</span>="<span class="html-attribute-value">none</span>" <span class="html-attribute-name">viewBox</span>="<span class="html-attribute-value">0 0 24 24</span>" <span class="html-attribute-name">stroke-width</span>="<span class="html-attribute-value">1.5</span>" <span class="html-attribute-name">stroke</span>="<span class="html-attribute-value">currentColor</span>"&gt;</span><span class="html-tag">&lt;path <span class="html-attribute-name">stroke-linecap</span>="<span class="html-attribute-value">round</span>" <span class="html-attribute-name">stroke-linejoin</span>="<span class="html-attribute-value">round</span>" <span class="html-attribute-name">d</span>="<span class="html-attribute-value">m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0</span>" /&gt;</span><span class="html-tag">&lt;/svg&gt;</span></td></tr><tr><td class="line-number" value="557"></td><td class="line-content">                        <span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="558"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="559"></td><td class="line-content">                        <span class="html-comment">&lt;!-- BURGER MENU BUTTON --&gt;</span></td></tr><tr><td class="line-number" value="560"></td><td class="line-content">                        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">burger-menu-container</span>"&gt;</span></td></tr><tr><td class="line-number" value="561"></td><td class="line-content">                            <span class="html-tag">&lt;button <span class="html-attribute-name">id</span>="<span class="html-attribute-value">burger-btn</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">icon-btn</span>"&gt;</span></td></tr><tr><td class="line-number" value="562"></td><td class="line-content">                                <span class="html-tag">&lt;svg <span class="html-attribute-name">fill</span>="<span class="html-attribute-value">none</span>" <span class="html-attribute-name">viewBox</span>="<span class="html-attribute-value">0 0 24 24</span>" <span class="html-attribute-name">stroke-width</span>="<span class="html-attribute-value">2</span>" <span class="html-attribute-name">stroke</span>="<span class="html-attribute-value">currentColor</span>"&gt;</span><span class="html-tag">&lt;path <span class="html-attribute-name">stroke-linecap</span>="<span class="html-attribute-value">round</span>" <span class="html-attribute-name">stroke-linejoin</span>="<span class="html-attribute-value">round</span>" <span class="html-attribute-name">d</span>="<span class="html-attribute-value">M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5</span>" /&gt;</span><span class="html-tag">&lt;/svg&gt;</span></td></tr><tr><td class="line-number" value="563"></td><td class="line-content">                            <span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="564"></td><td class="line-content">                            <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">menu-dropdown</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">menu-dropdown</span>"&gt;</span></td></tr><tr><td class="line-number" value="565"></td><td class="line-content">                                <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">menu-item</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">copy-invite-link</span>"&gt;</span>Copy Invite Link<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="566"></td><td class="line-content">                                <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">menu-item</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">toggle-dark-mode</span>"&gt;</span>Toggle Dark Mode<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="567"></td><td class="line-content">                                <span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="https://chat.tamarto.com/inspector.html" rel="noreferrer noopener">inspector.html</a>" <span class="html-attribute-name">target</span>="<span class="html-attribute-value">_blank</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">menu-item</span>"&gt;</span>Open Inspector<span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="568"></td><td class="line-content">                            <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="569"></td><td class="line-content">                        <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="570"></td><td class="line-content">                    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="571"></td><td class="line-content">                <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="572"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="573"></td><td class="line-content">                <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">chat-messages-container</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chat-messages-container</span>"&gt;</span></td></tr><tr><td class="line-number" value="574"></td><td class="line-content">                    <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">messages-wrapper</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">messages-wrapper</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="575"></td><td class="line-content">                <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="576"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="577"></td><td class="line-content">                <span class="html-tag">&lt;form <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chat-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="578"></td><td class="line-content">                    <span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">message-input</span>" <span class="html-attribute-name">placeholder</span>="<span class="html-attribute-value">Type a message...</span>" <span class="html-attribute-name">autocomplete</span>="<span class="html-attribute-value">off</span>"&gt;</span></td></tr><tr><td class="line-number" value="579"></td><td class="line-content">                    <span class="html-tag">&lt;button <span class="html-attribute-name">type</span>="<span class="html-attribute-value">submit</span>"&gt;</span>Send<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="580"></td><td class="line-content">                <span class="html-tag">&lt;/form&gt;</span></td></tr><tr><td class="line-number" value="581"></td><td class="line-content">                <span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">status-indicator</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">sync-status</span>"&gt;</span>Connected<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="582"></td><td class="line-content">            <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="583"></td><td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="584"></td><td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="585"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="586"></td><td class="line-content">    <span class="html-comment">&lt;!-- CREATE MODAL --&gt;</span></td></tr><tr><td class="line-number" value="587"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">create-modal</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-overlay</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">display: none;</span>"&gt;</span></td></tr><tr><td class="line-number" value="588"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-content</span>"&gt;</span></td></tr><tr><td class="line-number" value="589"></td><td class="line-content">            <span class="html-tag">&lt;h3&gt;</span>New Secure Channel<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="590"></td><td class="line-content">            <span class="html-tag">&lt;form <span class="html-attribute-name">id</span>="<span class="html-attribute-value">create-chat-form</span>"&gt;</span></td></tr><tr><td class="line-number" value="591"></td><td class="line-content">                <span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">new-chat-subject</span>" <span class="html-attribute-name">placeholder</span>="<span class="html-attribute-value">Subject</span>" <span class="html-attribute-name">autocomplete</span>="<span class="html-attribute-value">off</span>"&gt;</span></td></tr><tr><td class="line-number" value="592"></td><td class="line-content">                <span class="html-tag">&lt;input <span class="html-attribute-name">type</span>="<span class="html-attribute-value">password</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">new-chat-password</span>" <span class="html-attribute-name">placeholder</span>="<span class="html-attribute-value">Set Password</span>" <span class="html-attribute-name">autocomplete</span>="<span class="html-attribute-value">new-password</span>"&gt;</span></td></tr><tr><td class="line-number" value="593"></td><td class="line-content">                <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-actions</span>"&gt;</span></td></tr><tr><td class="line-number" value="594"></td><td class="line-content">                    <span class="html-tag">&lt;button <span class="html-attribute-name">type</span>="<span class="html-attribute-value">button</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">document.getElementById('create-modal').style.display='none'</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">secondary</span>"&gt;</span>Cancel<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="595"></td><td class="line-content">                    <span class="html-tag">&lt;button <span class="html-attribute-name">type</span>="<span class="html-attribute-value">submit</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">confirm-create-btn</span>"&gt;</span>Create<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="596"></td><td class="line-content">                <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="597"></td><td class="line-content">            <span class="html-tag">&lt;/form&gt;</span></td></tr><tr><td class="line-number" value="598"></td><td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="599"></td><td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="600"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="601"></td><td class="line-content">    <span class="html-comment">&lt;!-- MESSAGE OPTIONS MODAL --&gt;</span></td></tr><tr><td class="line-number" value="602"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">message-options-modal</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-overlay</span>"&gt;</span></td></tr><tr><td class="line-number" value="603"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">message-options-bar</span>"&gt;</span></td></tr><tr><td class="line-number" value="604"></td><td class="line-content">            <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">emoji-opt</span>" <span class="html-attribute-name">data-emoji</span>="<span class="html-attribute-value"></span>"&gt;</span><span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="605"></td><td class="line-content">            <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">emoji-opt</span>" <span class="html-attribute-name">data-emoji</span>="<span class="html-attribute-value"></span>"&gt;</span><span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="606"></td><td class="line-content">            <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">emoji-opt</span>" <span class="html-attribute-name">data-emoji</span>="<span class="html-attribute-value"></span>"&gt;</span><span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="607"></td><td class="line-content">            <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">emoji-opt</span>" <span class="html-attribute-name">data-emoji</span>="<span class="html-attribute-value"></span>"&gt;</span><span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="608"></td><td class="line-content">            <span class="html-tag">&lt;button <span class="html-attribute-name">class</span>="<span class="html-attribute-value">emoji-opt</span>" <span class="html-attribute-name">data-emoji</span>="<span class="html-attribute-value"></span>"&gt;</span><span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="609"></td><td class="line-content">            <span class="html-tag">&lt;button <span class="html-attribute-name">id</span>="<span class="html-attribute-value">msg-opt-delete</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">delete-opt-btn</span>" <span class="html-attribute-name">title</span>="<span class="html-attribute-value">Delete Message</span>"&gt;</span></td></tr><tr><td class="line-number" value="610"></td><td class="line-content">                <span class="html-tag">&lt;svg <span class="html-attribute-name">fill</span>="<span class="html-attribute-value">none</span>" <span class="html-attribute-name">viewBox</span>="<span class="html-attribute-value">0 0 24 24</span>" <span class="html-attribute-name">stroke-width</span>="<span class="html-attribute-value">2</span>" <span class="html-attribute-name">stroke</span>="<span class="html-attribute-value">currentColor</span>"&gt;</span><span class="html-tag">&lt;path <span class="html-attribute-name">stroke-linecap</span>="<span class="html-attribute-value">round</span>" <span class="html-attribute-name">stroke-linejoin</span>="<span class="html-attribute-value">round</span>" <span class="html-attribute-name">d</span>="<span class="html-attribute-value">m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0</span>" /&gt;</span><span class="html-tag">&lt;/svg&gt;</span></td></tr><tr><td class="line-number" value="611"></td><td class="line-content">            <span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="612"></td><td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="613"></td><td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="614"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="615"></td><td class="line-content">    <span class="html-comment">&lt;!-- DELETE CONFIRMATION MODAL --&gt;</span></td></tr><tr><td class="line-number" value="616"></td><td class="line-content">    <span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">delete-modal</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-overlay</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">display: none;</span>"&gt;</span></td></tr><tr><td class="line-number" value="617"></td><td class="line-content">        <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-content</span>"&gt;</span></td></tr><tr><td class="line-number" value="618"></td><td class="line-content">            <span class="html-tag">&lt;h3 <span class="html-attribute-name">id</span>="<span class="html-attribute-value">modal-title</span>"&gt;</span>Delete Chat?<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="619"></td><td class="line-content">            <span class="html-tag">&lt;p <span class="html-attribute-name">id</span>="<span class="html-attribute-value">modal-text</span>"&gt;</span>Are you sure? This will remove the chat from your list and clear history.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="620"></td><td class="line-content">            <span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">modal-actions</span>"&gt;</span></td></tr><tr><td class="line-number" value="621"></td><td class="line-content">                <span class="html-tag">&lt;button <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">document.getElementById('delete-modal').style.display='none'</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">secondary</span>"&gt;</span>Cancel<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="622"></td><td class="line-content">                <span class="html-tag">&lt;button <span class="html-attribute-name">id</span>="<span class="html-attribute-value">confirm-delete-btn</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">danger</span>"&gt;</span>Delete<span class="html-tag">&lt;/button&gt;</span></td></tr><tr><td class="line-number" value="623"></td><td class="line-content">            <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="624"></td><td class="line-content">        <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="625"></td><td class="line-content">    <span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="626"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="627"></td><td class="line-content">    <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="628"></td><td class="line-content">        document.addEventListener('DOMContentLoaded', () =&gt; {</td></tr><tr><td class="line-number" value="629"></td><td class="line-content">            const $ = (selector) =&gt; document.querySelector(selector);</td></tr><tr><td class="line-number" value="630"></td><td class="line-content">            const $$ = (selector) =&gt; document.querySelectorAll(selector);</td></tr><tr><td class="line-number" value="631"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="632"></td><td class="line-content">            // --- SILENT INSPECTOR LOGGER MODULE ---</td></tr><tr><td class="line-number" value="633"></td><td class="line-content">            const Logger = (() =&gt; {</td></tr><tr><td class="line-number" value="634"></td><td class="line-content">                const channel = new BroadcastChannel('tamarto_debug');</td></tr><tr><td class="line-number" value="635"></td><td class="line-content">                function send(type, args) {</td></tr><tr><td class="line-number" value="636"></td><td class="line-content">                    const safeArgs = args.map(a =&gt; {</td></tr><tr><td class="line-number" value="637"></td><td class="line-content">                        if (a instanceof Error) return { message: a.message, stack: a.stack };</td></tr><tr><td class="line-number" value="638"></td><td class="line-content">                        try { return JSON.parse(JSON.stringify(a)); }</td></tr><tr><td class="line-number" value="639"></td><td class="line-content">                        catch (e) { return String(a); }</td></tr><tr><td class="line-number" value="640"></td><td class="line-content">                    });</td></tr><tr><td class="line-number" value="641"></td><td class="line-content">                    // Only send to inspector, NO console.log here</td></tr><tr><td class="line-number" value="642"></td><td class="line-content">                    channel.postMessage({ type, timestamp: new Date().toISOString(), data: safeArgs });</td></tr><tr><td class="line-number" value="643"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="644"></td><td class="line-content">                return {</td></tr><tr><td class="line-number" value="645"></td><td class="line-content">                    log: (...args) =&gt; send('log', args),</td></tr><tr><td class="line-number" value="646"></td><td class="line-content">                    error: (...args) =&gt; send('error', args),</td></tr><tr><td class="line-number" value="647"></td><td class="line-content">                    warn: (...args) =&gt; send('warn', args),</td></tr><tr><td class="line-number" value="648"></td><td class="line-content">                    info: (...args) =&gt; send('info', args)</td></tr><tr><td class="line-number" value="649"></td><td class="line-content">                };</td></tr><tr><td class="line-number" value="650"></td><td class="line-content">            })();</td></tr><tr><td class="line-number" value="651"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="652"></td><td class="line-content">            function logToUI(msg, isError = false) {</td></tr><tr><td class="line-number" value="653"></td><td class="line-content">                const logArea = $('#unlock-message');</td></tr><tr><td class="line-number" value="654"></td><td class="line-content">                if (logArea) {</td></tr><tr><td class="line-number" value="655"></td><td class="line-content">                    logArea.innerHTML = msg;</td></tr><tr><td class="line-number" value="656"></td><td class="line-content">                    logArea.style.color = isError ? 'red' : 'var(--secondary-color)';</td></tr><tr><td class="line-number" value="657"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="658"></td><td class="line-content">                const chatStatus = $('#sync-status');</td></tr><tr><td class="line-number" value="659"></td><td class="line-content">                if (chatStatus) chatStatus.textContent = msg;</td></tr><tr><td class="line-number" value="660"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="661"></td><td class="line-content">                // Send to Inspector</td></tr><tr><td class="line-number" value="662"></td><td class="line-content">                if (isError) Logger.error("UI:", msg);</td></tr><tr><td class="line-number" value="663"></td><td class="line-content">                else Logger.info("UI:", msg);</td></tr><tr><td class="line-number" value="664"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="665"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="666"></td><td class="line-content">            // --- STATE MANAGEMENT ---</td></tr><tr><td class="line-number" value="667"></td><td class="line-content">            let authToken = null;</td></tr><tr><td class="line-number" value="668"></td><td class="line-content">            let masterKey = null;</td></tr><tr><td class="line-number" value="669"></td><td class="line-content">            let userChatList = [];</td></tr><tr><td class="line-number" value="670"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="671"></td><td class="line-content">            let currentChatId = null;</td></tr><tr><td class="line-number" value="672"></td><td class="line-content">            let currentChatKey = null;</td></tr><tr><td class="line-number" value="673"></td><td class="line-content">            let currentSignKey = null;</td></tr><tr><td class="line-number" value="674"></td><td class="line-content">            let chatData = { messages: [], lastActive: Date.now() };</td></tr><tr><td class="line-number" value="675"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="676"></td><td class="line-content">            let userHandle = '';</td></tr><tr><td class="line-number" value="677"></td><td class="line-content">            // let pollingInterval = null; // REMOVED POLLING VAR</td></tr><tr><td class="line-number" value="678"></td><td class="line-content">            let timerInterval = null;</td></tr><tr><td class="line-number" value="679"></td><td class="line-content">            let pendingActionMsgId = null;</td></tr><tr><td class="line-number" value="680"></td><td class="line-content">            let activeEventSources = []; // NEW: Track connections</td></tr><tr><td class="line-number" value="681"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="682"></td><td class="line-content">            const INACTIVITY_LIMIT_MS = 30 * 60 * 1000; // 30 minutes</td></tr><tr><td class="line-number" value="683"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="684"></td><td class="line-content">            const NODES = [</td></tr><tr><td class="line-number" value="685"></td><td class="line-content">                { url: 'https://node1.cabidge.com', name: 'Node 1' },</td></tr><tr><td class="line-number" value="686"></td><td class="line-content">                { url: 'https://node2.cabidge.com', name: 'Node 2' },</td></tr><tr><td class="line-number" value="687"></td><td class="line-content">                { url: 'https://node3.cabidge.com', name: 'Node 3' }</td></tr><tr><td class="line-number" value="688"></td><td class="line-content">            ];</td></tr><tr><td class="line-number" value="689"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="690"></td><td class="line-content">            // --- CRYPTO HELPERS (INSTRUMENTED) ---</td></tr><tr><td class="line-number" value="691"></td><td class="line-content">            async function deriveKeysArgon2(password, salt) {</td></tr><tr><td class="line-number" value="692"></td><td class="line-content">                Logger.info("Argon2: Deriving keys for salt...", salt);</td></tr><tr><td class="line-number" value="693"></td><td class="line-content">                try {</td></tr><tr><td class="line-number" value="694"></td><td class="line-content">                    const saltBuffer = (typeof salt === 'string') ? new TextEncoder().encode(salt) : salt;</td></tr><tr><td class="line-number" value="695"></td><td class="line-content">                    const argon2Result = await argon2.hash({</td></tr><tr><td class="line-number" value="696"></td><td class="line-content">                        pass: password, salt: saltBuffer, time: 2, mem: 1024 * 32,</td></tr><tr><td class="line-number" value="697"></td><td class="line-content">                        hashLen: 64, parallelism: 1, type: argon2.ArgonType.Argon2id</td></tr><tr><td class="line-number" value="698"></td><td class="line-content">                    });</td></tr><tr><td class="line-number" value="699"></td><td class="line-content">                    const encKey = await crypto.subtle.importKey("raw", argon2Result.hash.slice(0, 32), { name: "AES-GCM" }, true, ["encrypt", "decrypt"]);</td></tr><tr><td class="line-number" value="700"></td><td class="line-content">                    const sigKey = await crypto.subtle.importKey("raw", argon2Result.hash.slice(32, 64), { name: "HMAC", hash: "SHA-256" }, true, ["sign", "verify"]);</td></tr><tr><td class="line-number" value="701"></td><td class="line-content">                    Logger.info("Argon2: Keys derived successfully.");</td></tr><tr><td class="line-number" value="702"></td><td class="line-content">                    return { encKey, sigKey };</td></tr><tr><td class="line-number" value="703"></td><td class="line-content">                } catch (e) {</td></tr><tr><td class="line-number" value="704"></td><td class="line-content">                    logToUI("Argon2 Failed.", true);</td></tr><tr><td class="line-number" value="705"></td><td class="line-content">                    Logger.error("Argon2 Failed", e);</td></tr><tr><td class="line-number" value="706"></td><td class="line-content">                    throw e;</td></tr><tr><td class="line-number" value="707"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="708"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="709"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="710"></td><td class="line-content">            async function encryptData(key, jsonData) {</td></tr><tr><td class="line-number" value="711"></td><td class="line-content">                Logger.log("Crypto: Encrypting payload...");</td></tr><tr><td class="line-number" value="712"></td><td class="line-content">                const iv = crypto.getRandomValues(new Uint8Array(12));</td></tr><tr><td class="line-number" value="713"></td><td class="line-content">                const ciphertext = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, new TextEncoder().encode(jsonData));</td></tr><tr><td class="line-number" value="714"></td><td class="line-content">                Logger.log("Crypto: Encryption complete. IV:", bytesToHex(iv));</td></tr><tr><td class="line-number" value="715"></td><td class="line-content">                return { iv: bytesToHex(iv), payload: btoa(String.fromCharCode.apply(null, new Uint8Array(ciphertext))) };</td></tr><tr><td class="line-number" value="716"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="717"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="718"></td><td class="line-content">            async function decryptData(key, packet) {</td></tr><tr><td class="line-number" value="719"></td><td class="line-content">                Logger.log("Crypto: Decrypting packet. IV:", packet.iv);</td></tr><tr><td class="line-number" value="720"></td><td class="line-content">                const iv = hexToBytes(packet.iv);</td></tr><tr><td class="line-number" value="721"></td><td class="line-content">                const ciphertext = new Uint8Array(atob(packet.payload).split('').map(c =&gt; c.charCodeAt(0)));</td></tr><tr><td class="line-number" value="722"></td><td class="line-content">                const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext);</td></tr><tr><td class="line-number" value="723"></td><td class="line-content">                Logger.log("Crypto: Decryption successful.");</td></tr><tr><td class="line-number" value="724"></td><td class="line-content">                return new TextDecoder().decode(decrypted);</td></tr><tr><td class="line-number" value="725"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="726"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="727"></td><td class="line-content">            async function signMessage(messageData, key) {</td></tr><tr><td class="line-number" value="728"></td><td class="line-content">                Logger.log("Crypto: Signing message...");</td></tr><tr><td class="line-number" value="729"></td><td class="line-content">                const data = new TextEncoder().encode(JSON.stringify(messageData));</td></tr><tr><td class="line-number" value="730"></td><td class="line-content">                const signature = await crypto.subtle.sign('HMAC', key, data);</td></tr><tr><td class="line-number" value="731"></td><td class="line-content">                Logger.log("Crypto: Signed.");</td></tr><tr><td class="line-number" value="732"></td><td class="line-content">                return bytesToHex(new Uint8Array(signature));</td></tr><tr><td class="line-number" value="733"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="734"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="735"></td><td class="line-content">            function bytesToHex(bytes) { return Array.from(bytes).map(b =&gt; b.toString(16).padStart(2, '0')).join(''); }</td></tr><tr><td class="line-number" value="736"></td><td class="line-content">            function hexToBytes(hex) { return new Uint8Array(hex.match(/.{1,2}/g).map(byte =&gt; parseInt(byte, 16))); }</td></tr><tr><td class="line-number" value="737"></td><td class="line-content">            function strToHex(str) { return Array.from(new TextEncoder().encode(str)).map(b =&gt; b.toString(16).padStart(2, '0')).join(''); }</td></tr><tr><td class="line-number" value="738"></td><td class="line-content">            function hexToStr(hex) { return new TextDecoder().decode(new Uint8Array(hex.match(/.{1,2}/g).map(byte =&gt; parseInt(byte, 16)))); }</td></tr><tr><td class="line-number" value="739"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="740"></td><td class="line-content">            // Shamir Secret Sharing</td></tr><tr><td class="line-number" value="741"></td><td class="line-content">            const Shamir = (() =&gt; {</td></tr><tr><td class="line-number" value="742"></td><td class="line-content">                const logs = [], exps = [];</td></tr><tr><td class="line-number" value="743"></td><td class="line-content">                for (let i = 0, x = 1; i &lt; 256; i++) { exps[i] = x; logs[x] = i; x &lt;&lt;= 1; if (x &gt;= 256) x ^= 0x11d; }</td></tr><tr><td class="line-number" value="744"></td><td class="line-content">                const add = (a, b) =&gt; a ^ b;</td></tr><tr><td class="line-number" value="745"></td><td class="line-content">                const div = (a, b) =&gt; (b === 0 || a === 0) ? 0 : exps[(logs[a] + 255 - logs[b]) % 255];</td></tr><tr><td class="line-number" value="746"></td><td class="line-content">                const mult = (a, b) =&gt; (a === 0 || b === 0) ? 0 : exps[(logs[a] + logs[b]) % 255];</td></tr><tr><td class="line-number" value="747"></td><td class="line-content">                function split(secretHex, n, k) {</td></tr><tr><td class="line-number" value="748"></td><td class="line-content">                    if (secretHex.length % 2 !== 0) secretHex = '0' + secretHex;</td></tr><tr><td class="line-number" value="749"></td><td class="line-content">                    const len = secretHex.length / 2;</td></tr><tr><td class="line-number" value="750"></td><td class="line-content">                    const bins = [];</td></tr><tr><td class="line-number" value="751"></td><td class="line-content">                    for (let i = 0; i &lt; len; i++) bins.push(parseInt(secretHex.substr(i * 2, 2), 16));</td></tr><tr><td class="line-number" value="752"></td><td class="line-content">                    const shares = Array.from({ length: n }, (_, i) =&gt; ({ id: i + 1, data: [] }));</td></tr><tr><td class="line-number" value="753"></td><td class="line-content">                    for (let i = 0; i &lt; len; i++) {</td></tr><tr><td class="line-number" value="754"></td><td class="line-content">                        const coeffs = [bins[i]];</td></tr><tr><td class="line-number" value="755"></td><td class="line-content">                        for (let c = 1; c &lt; k; c++) coeffs.push(crypto.getRandomValues(new Uint8Array(1))[0]);</td></tr><tr><td class="line-number" value="756"></td><td class="line-content">                        for (let x = 1; x &lt;= n; x++) {</td></tr><tr><td class="line-number" value="757"></td><td class="line-content">                            let y = coeffs[0];</td></tr><tr><td class="line-number" value="758"></td><td class="line-content">                            for (let c = 1; c &lt; k; c++) y = add(y, mult(coeffs[c], exps[(logs[x] * c) % 255]));</td></tr><tr><td class="line-number" value="759"></td><td class="line-content">                            shares[x - 1].data.push(y);</td></tr><tr><td class="line-number" value="760"></td><td class="line-content">                        }</td></tr><tr><td class="line-number" value="761"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="762"></td><td class="line-content">                    return shares.map(s =&gt; `80${s.id.toString(16).padStart(2, '0')}${s.data.map(b =&gt; b.toString(16).padStart(2, '0')).join('')}`);</td></tr><tr><td class="line-number" value="763"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="764"></td><td class="line-content">                function combine(sharesHex) {</td></tr><tr><td class="line-number" value="765"></td><td class="line-content">                    const shares = sharesHex.map(s =&gt; ({ id: parseInt(s.substr(2, 2), 16), data: hexToBytes(s.substr(4)) }));</td></tr><tr><td class="line-number" value="766"></td><td class="line-content">                    const k = shares.length;</td></tr><tr><td class="line-number" value="767"></td><td class="line-content">                    const len = shares[0].data.length;</td></tr><tr><td class="line-number" value="768"></td><td class="line-content">                    const secret = [];</td></tr><tr><td class="line-number" value="769"></td><td class="line-content">                    for (let i = 0; i &lt; len; i++) {</td></tr><tr><td class="line-number" value="770"></td><td class="line-content">                        let sum = 0;</td></tr><tr><td class="line-number" value="771"></td><td class="line-content">                        for (let j = 0; j &lt; k; j++) {</td></tr><tr><td class="line-number" value="772"></td><td class="line-content">                            let num = 1, den = 1;</td></tr><tr><td class="line-number" value="773"></td><td class="line-content">                            for (let m = 0; m &lt; k; m++) {</td></tr><tr><td class="line-number" value="774"></td><td class="line-content">                                if (j === m) continue;</td></tr><tr><td class="line-number" value="775"></td><td class="line-content">                                num = mult(num, shares[m].id);</td></tr><tr><td class="line-number" value="776"></td><td class="line-content">                                den = mult(den, add(shares[j].id, shares[m].id));</td></tr><tr><td class="line-number" value="777"></td><td class="line-content">                            }</td></tr><tr><td class="line-number" value="778"></td><td class="line-content">                            const basis = div(num, den);</td></tr><tr><td class="line-number" value="779"></td><td class="line-content">                            sum = add(sum, mult(shares[j].data[i], basis));</td></tr><tr><td class="line-number" value="780"></td><td class="line-content">                        }</td></tr><tr><td class="line-number" value="781"></td><td class="line-content">                        secret.push(sum);</td></tr><tr><td class="line-number" value="782"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="783"></td><td class="line-content">                    return secret.map(b =&gt; b.toString(16).padStart(2, '0')).join('');</td></tr><tr><td class="line-number" value="784"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="785"></td><td class="line-content">                return { split, combine };</td></tr><tr><td class="line-number" value="786"></td><td class="line-content">            })();</td></tr><tr><td class="line-number" value="787"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="788"></td><td class="line-content">            // --- API &amp; NODES ---</td></tr><tr><td class="line-number" value="789"></td><td class="line-content">            async function loadFromNodes(recordId, keyToDecrypt) {</td></tr><tr><td class="line-number" value="790"></td><td class="line-content">                if (!authToken) return null;</td></tr><tr><td class="line-number" value="791"></td><td class="line-content">                const safeRecordId = recordId || 'default';</td></tr><tr><td class="line-number" value="792"></td><td class="line-content">                logToUI(`Sync: ${safeRecordId}`);</td></tr><tr><td class="line-number" value="793"></td><td class="line-content">                Logger.info(`Orchestrator: Fetching ${safeRecordId} from distributed nodes...`);</td></tr><tr><td class="line-number" value="794"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="795"></td><td class="line-content">                const requests = NODES.map(node =&gt; {</td></tr><tr><td class="line-number" value="796"></td><td class="line-content">                    Logger.log(`Network: Requesting ${node.name}...`);</td></tr><tr><td class="line-number" value="797"></td><td class="line-content">                    return fetch(`${node.url}/api/getcurrent?recordId=${safeRecordId}`, {</td></tr><tr><td class="line-number" value="798"></td><td class="line-content">                        method: 'GET',</td></tr><tr><td class="line-number" value="799"></td><td class="line-content">                        headers: { 'Authorization': `Bearer ${authToken}` },</td></tr><tr><td class="line-number" value="800"></td><td class="line-content">                        signal: AbortSignal.timeout(3000)</td></tr><tr><td class="line-number" value="801"></td><td class="line-content">                    }).then(async r =&gt; {</td></tr><tr><td class="line-number" value="802"></td><td class="line-content">                        if (r.ok) {</td></tr><tr><td class="line-number" value="803"></td><td class="line-content">                            Logger.log(`${node.name}: 200 OK.`);</td></tr><tr><td class="line-number" value="804"></td><td class="line-content">                            const json = await r.json();</td></tr><tr><td class="line-number" value="805"></td><td class="line-content">                            return (Object.keys(json).length === 0) ? { isEmpty: true } : json;</td></tr><tr><td class="line-number" value="806"></td><td class="line-content">                        } else {</td></tr><tr><td class="line-number" value="807"></td><td class="line-content">                            Logger.warn(`${node.name}: ${r.status}`);</td></tr><tr><td class="line-number" value="808"></td><td class="line-content">                            return null;</td></tr><tr><td class="line-number" value="809"></td><td class="line-content">                        }</td></tr><tr><td class="line-number" value="810"></td><td class="line-content">                    }).catch(e =&gt; {</td></tr><tr><td class="line-number" value="811"></td><td class="line-content">                        Logger.error(`${node.name}: Conn Error`, e);</td></tr><tr><td class="line-number" value="812"></td><td class="line-content">                        return null;</td></tr><tr><td class="line-number" value="813"></td><td class="line-content">                    })</td></tr><tr><td class="line-number" value="814"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="815"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="816"></td><td class="line-content">                const results = await Promise.all(requests);</td></tr><tr><td class="line-number" value="817"></td><td class="line-content">                let fragments = [];</td></tr><tr><td class="line-number" value="818"></td><td class="line-content">                results.forEach(res =&gt; {</td></tr><tr><td class="line-number" value="819"></td><td class="line-content">                    if (res) {</td></tr><tr><td class="line-number" value="820"></td><td class="line-content">                        if (res.shares) fragments.push(...res.shares);</td></tr><tr><td class="line-number" value="821"></td><td class="line-content">                        else if (Array.isArray(res)) fragments.push(...res);</td></tr><tr><td class="line-number" value="822"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="823"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="824"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="825"></td><td class="line-content">                fragments = [...new Set(fragments.filter(s =&gt; typeof s === 'string' &amp;&amp; s.startsWith('80')))];</td></tr><tr><td class="line-number" value="826"></td><td class="line-content">                Logger.info(`Shamir: Found ${fragments.length} valid fragments.`);</td></tr><tr><td class="line-number" value="827"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="828"></td><td class="line-content">                if (fragments.length === 0) return { isEmpty: true };</td></tr><tr><td class="line-number" value="829"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="830"></td><td class="line-content">                try {</td></tr><tr><td class="line-number" value="831"></td><td class="line-content">                    Logger.log("Shamir: Reconstructing...");</td></tr><tr><td class="line-number" value="832"></td><td class="line-content">                    const combinedHex = Shamir.combine(fragments.slice(0, 6));</td></tr><tr><td class="line-number" value="833"></td><td class="line-content">                    if (!combinedHex) return { isEmpty: true };</td></tr><tr><td class="line-number" value="834"></td><td class="line-content">                    const encryptedPacket = JSON.parse(hexToStr(combinedHex));</td></tr><tr><td class="line-number" value="835"></td><td class="line-content">                    const decryptedJson = await decryptData(keyToDecrypt, encryptedPacket);</td></tr><tr><td class="line-number" value="836"></td><td class="line-content">                    return JSON.parse(decryptedJson);</td></tr><tr><td class="line-number" value="837"></td><td class="line-content">                } catch (e) {</td></tr><tr><td class="line-number" value="838"></td><td class="line-content">                    Logger.error("Decrypt Failed", e);</td></tr><tr><td class="line-number" value="839"></td><td class="line-content">                    return null;</td></tr><tr><td class="line-number" value="840"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="841"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="842"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="843"></td><td class="line-content">            async function saveToNodes(recordId, dataObj, keyToEncrypt) {</td></tr><tr><td class="line-number" value="844"></td><td class="line-content">                if (!authToken) return;</td></tr><tr><td class="line-number" value="845"></td><td class="line-content">                const safeRecordId = recordId || 'default';</td></tr><tr><td class="line-number" value="846"></td><td class="line-content">                $('#sync-status').textContent = 'Saving...';</td></tr><tr><td class="line-number" value="847"></td><td class="line-content">                Logger.info(`Orchestrator: Initiating Save...`);</td></tr><tr><td class="line-number" value="848"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="849"></td><td class="line-content">                try {</td></tr><tr><td class="line-number" value="850"></td><td class="line-content">                    const jsonStr = JSON.stringify(dataObj);</td></tr><tr><td class="line-number" value="851"></td><td class="line-content">                    const encrypted = await encryptData(keyToEncrypt, jsonStr);</td></tr><tr><td class="line-number" value="852"></td><td class="line-content">                    const packet = JSON.stringify({ timestamp: Date.now(), ...encrypted });</td></tr><tr><td class="line-number" value="853"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="854"></td><td class="line-content">                    const shares = Shamir.split(strToHex(packet), 6, 2);</td></tr><tr><td class="line-number" value="855"></td><td class="line-content">                    const nodePayloads = [[shares[0], shares[1]], [shares[2], shares[3]], [shares[4], shares[5]]];</td></tr><tr><td class="line-number" value="856"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="857"></td><td class="line-content">                    await Promise.all(NODES.map((node, i) =&gt; {</td></tr><tr><td class="line-number" value="858"></td><td class="line-content">                        return fetch(`${node.url}/api/hereyouare?recordId=${safeRecordId}`, {</td></tr><tr><td class="line-number" value="859"></td><td class="line-content">                            method: 'POST',</td></tr><tr><td class="line-number" value="860"></td><td class="line-content">                            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${authToken}` },</td></tr><tr><td class="line-number" value="861"></td><td class="line-content">                            body: JSON.stringify({ shares: nodePayloads[i] })</td></tr><tr><td class="line-number" value="862"></td><td class="line-content">                        }).then(r =&gt; {</td></tr><tr><td class="line-number" value="863"></td><td class="line-content">                            if (r.ok) Logger.log(`${node.name}: Saved.`);</td></tr><tr><td class="line-number" value="864"></td><td class="line-content">                            else Logger.warn(`${node.name}: Save Failed ${r.status}`);</td></tr><tr><td class="line-number" value="865"></td><td class="line-content">                        })</td></tr><tr><td class="line-number" value="866"></td><td class="line-content">                    }));</td></tr><tr><td class="line-number" value="867"></td><td class="line-content">                    $('#sync-status').textContent = 'Saved';</td></tr><tr><td class="line-number" value="868"></td><td class="line-content">                } catch (e) {</td></tr><tr><td class="line-number" value="869"></td><td class="line-content">                    $('#sync-status').textContent = 'Save Failed';</td></tr><tr><td class="line-number" value="870"></td><td class="line-content">                    Logger.error("Save Process Failed", e);</td></tr><tr><td class="line-number" value="871"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="872"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="873"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="874"></td><td class="line-content">            // --- LINK PARSING ---</td></tr><tr><td class="line-number" value="875"></td><td class="line-content">            function escapeHtml(text) {</td></tr><tr><td class="line-number" value="876"></td><td class="line-content">                if (!text) return text;</td></tr><tr><td class="line-number" value="877"></td><td class="line-content">                return text.replace(/&amp;/g, "&amp;amp;").replace(/&lt;/g, "&amp;lt;").replace(/&gt;/g, "&amp;gt;").replace(/"/g, "&amp;quot;").replace(/'/g, "&amp;#039;");</td></tr><tr><td class="line-number" value="878"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="879"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="880"></td><td class="line-content">            function formatMessageText(text) {</td></tr><tr><td class="line-number" value="881"></td><td class="line-content">                let safe = escapeHtml(text);</td></tr><tr><td class="line-number" value="882"></td><td class="line-content">                const urlRegex = /(https?:\/\/[^\s]+)/g;</td></tr><tr><td class="line-number" value="883"></td><td class="line-content">                return safe.replace(urlRegex, function (url) {</td></tr><tr><td class="line-number" value="884"></td><td class="line-content">                    return `&lt;a href="${url}" target="_blank" rel="noopener noreferrer"&gt;${url}&lt;/a&gt;`;</td></tr><tr><td class="line-number" value="885"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="886"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="887"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="888"></td><td class="line-content">            // --- TIMER LOGIC ---</td></tr><tr><td class="line-number" value="889"></td><td class="line-content">            function updateInactivityTimer() {</td></tr><tr><td class="line-number" value="890"></td><td class="line-content">                const timerDisplay = $('#expiry-timer');</td></tr><tr><td class="line-number" value="891"></td><td class="line-content">                let lastTime = chatData.lastActive;</td></tr><tr><td class="line-number" value="892"></td><td class="line-content">                if (!lastTime &amp;&amp; chatData.messages &amp;&amp; chatData.messages.length &gt; 0) {</td></tr><tr><td class="line-number" value="893"></td><td class="line-content">                    const lastMsg = chatData.messages[chatData.messages.length - 1];</td></tr><tr><td class="line-number" value="894"></td><td class="line-content">                    lastTime = new Date(lastMsg.timestamp).getTime();</td></tr><tr><td class="line-number" value="895"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="896"></td><td class="line-content">                if (!lastTime) lastTime = Date.now();</td></tr><tr><td class="line-number" value="897"></td><td class="line-content">                const now = Date.now();</td></tr><tr><td class="line-number" value="898"></td><td class="line-content">                const diff = now - lastTime;</td></tr><tr><td class="line-number" value="899"></td><td class="line-content">                const remaining = INACTIVITY_LIMIT_MS - diff;</td></tr><tr><td class="line-number" value="900"></td><td class="line-content">                if (remaining &lt;= 0) {</td></tr><tr><td class="line-number" value="901"></td><td class="line-content">                    timerDisplay.textContent = "EXPIRED";</td></tr><tr><td class="line-number" value="902"></td><td class="line-content">                    timerDisplay.className = 'expiry-timer critical';</td></tr><tr><td class="line-number" value="903"></td><td class="line-content">                    return;</td></tr><tr><td class="line-number" value="904"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="905"></td><td class="line-content">                const minutes = Math.floor(remaining / 60000);</td></tr><tr><td class="line-number" value="906"></td><td class="line-content">                const seconds = Math.floor((remaining % 60000) / 1000);</td></tr><tr><td class="line-number" value="907"></td><td class="line-content">                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;</td></tr><tr><td class="line-number" value="908"></td><td class="line-content">                timerDisplay.classList.remove('warning', 'critical');</td></tr><tr><td class="line-number" value="909"></td><td class="line-content">                if (minutes &lt; 5) timerDisplay.classList.add('critical');</td></tr><tr><td class="line-number" value="910"></td><td class="line-content">                else if (minutes &lt; 10) timerDisplay.classList.add('warning');</td></tr><tr><td class="line-number" value="911"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="912"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="913"></td><td class="line-content">            function startTimerLoop() {</td></tr><tr><td class="line-number" value="914"></td><td class="line-content">                if (timerInterval) clearInterval(timerInterval);</td></tr><tr><td class="line-number" value="915"></td><td class="line-content">                timerInterval = setInterval(updateInactivityTimer, 1000);</td></tr><tr><td class="line-number" value="916"></td><td class="line-content">                updateInactivityTimer();</td></tr><tr><td class="line-number" value="917"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="918"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="919"></td><td class="line-content">            // --- APP CORE ---</td></tr><tr><td class="line-number" value="920"></td><td class="line-content">            async function unlockHub(password) {</td></tr><tr><td class="line-number" value="921"></td><td class="line-content">                Logger.info("System: Unlocking Hub...");</td></tr><tr><td class="line-number" value="922"></td><td class="line-content">                const keys = await deriveKeysArgon2(password, "Tamarto_Keychain_Root_Salt");</td></tr><tr><td class="line-number" value="923"></td><td class="line-content">                masterKey = keys.encKey;</td></tr><tr><td class="line-number" value="924"></td><td class="line-content">                const data = await loadFromNodes('keychain', masterKey);</td></tr><tr><td class="line-number" value="925"></td><td class="line-content">                if (data &amp;&amp; !data.isEmpty) userChatList = Array.isArray(data) ? data : [];</td></tr><tr><td class="line-number" value="926"></td><td class="line-content">                $('#unlock-container').style.display = 'none';</td></tr><tr><td class="line-number" value="927"></td><td class="line-content">                $('#lobby-container').style.display = 'block';</td></tr><tr><td class="line-number" value="928"></td><td class="line-content">                renderLobby();</td></tr><tr><td class="line-number" value="929"></td><td class="line-content">                if ($('#join-id-input').value) $('#join-id-input').scrollIntoView();</td></tr><tr><td class="line-number" value="930"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="931"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="932"></td><td class="line-content">            function renderLobby() {</td></tr><tr><td class="line-number" value="933"></td><td class="line-content">                const container = $('#chat-list-container');</td></tr><tr><td class="line-number" value="934"></td><td class="line-content">                container.innerHTML = '';</td></tr><tr><td class="line-number" value="935"></td><td class="line-content">                userChatList.forEach(chat =&gt; {</td></tr><tr><td class="line-number" value="936"></td><td class="line-content">                    const div = document.createElement('div');</td></tr><tr><td class="line-number" value="937"></td><td class="line-content">                    div.className = 'chat-list-item';</td></tr><tr><td class="line-number" value="938"></td><td class="line-content">                    div.innerHTML = `&lt;div&gt;&lt;h3&gt;${chat.name}&lt;/h3&gt;&lt;small&gt;ID: ${chat.id.substring(0, 8)}...&lt;/small&gt;&lt;/div&gt;&lt;button style="width:auto; padding:5px 15px;" class="open-chat-btn"&gt;Open&lt;/button&gt;`;</td></tr><tr><td class="line-number" value="939"></td><td class="line-content">                    div.querySelector('.open-chat-btn').onclick = (e) =&gt; { e.stopPropagation(); enterChat(chat); };</td></tr><tr><td class="line-number" value="940"></td><td class="line-content">                    container.appendChild(div);</td></tr><tr><td class="line-number" value="941"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="942"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="943"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="944"></td><td class="line-content">            async function createNewChat() {</td></tr><tr><td class="line-number" value="945"></td><td class="line-content">                const name = $('#new-chat-subject').value;</td></tr><tr><td class="line-number" value="946"></td><td class="line-content">                const pass = $('#new-chat-password').value;</td></tr><tr><td class="line-number" value="947"></td><td class="line-content">                if (!name || !pass) return;</td></tr><tr><td class="line-number" value="948"></td><td class="line-content">                Logger.info("System: Creating New Chat", name);</td></tr><tr><td class="line-number" value="949"></td><td class="line-content">                const newId = crypto.randomUUID();</td></tr><tr><td class="line-number" value="950"></td><td class="line-content">                userChatList.push({ id: newId, name: name, savedPass: pass });</td></tr><tr><td class="line-number" value="951"></td><td class="line-content">                await saveToNodes('keychain', userChatList, masterKey);</td></tr><tr><td class="line-number" value="952"></td><td class="line-content">                $('#create-modal').style.display = 'none';</td></tr><tr><td class="line-number" value="953"></td><td class="line-content">                renderLobby();</td></tr><tr><td class="line-number" value="954"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="955"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="956"></td><td class="line-content">            async function joinExternalChat() {</td></tr><tr><td class="line-number" value="957"></td><td class="line-content">                const idVal = $('#join-id-input').value.trim();</td></tr><tr><td class="line-number" value="958"></td><td class="line-content">                const pass = $('#join-pass-input').value;</td></tr><tr><td class="line-number" value="959"></td><td class="line-content">                if (!idVal || !pass) return;</td></tr><tr><td class="line-number" value="960"></td><td class="line-content">                const id = idVal.includes('join=') ? idVal.split('join=')[1] : idVal;</td></tr><tr><td class="line-number" value="961"></td><td class="line-content">                Logger.info("System: Joining External Chat", id);</td></tr><tr><td class="line-number" value="962"></td><td class="line-content">                userChatList.push({ id: id, name: "Joined Chat", savedPass: pass });</td></tr><tr><td class="line-number" value="963"></td><td class="line-content">                await saveToNodes('keychain', userChatList, masterKey);</td></tr><tr><td class="line-number" value="964"></td><td class="line-content">                $('#join-id-input').value = '';</td></tr><tr><td class="line-number" value="965"></td><td class="line-content">                renderLobby();</td></tr><tr><td class="line-number" value="966"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="967"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="968"></td><td class="line-content">            async function enterChat(chatConfig) {</td></tr><tr><td class="line-number" value="969"></td><td class="line-content">                Logger.info("System: Entering Room", chatConfig.id);</td></tr><tr><td class="line-number" value="970"></td><td class="line-content">                $('#lobby-container').style.display = 'none';</td></tr><tr><td class="line-number" value="971"></td><td class="line-content">                $('#chat-app').style.display = 'flex';</td></tr><tr><td class="line-number" value="972"></td><td class="line-content">                $('#back-to-lobby-btn').style.display = 'block';</td></tr><tr><td class="line-number" value="973"></td><td class="line-content">                $('#chat-container').style.display = 'none';</td></tr><tr><td class="line-number" value="974"></td><td class="line-content">                $('#handle-container').style.display = 'block';</td></tr><tr><td class="line-number" value="975"></td><td class="line-content">                $('#chat-title-display').textContent = chatConfig.name;</td></tr><tr><td class="line-number" value="976"></td><td class="line-content">                $('#chat-id-display').textContent = `ID: ${chatConfig.id}`;</td></tr><tr><td class="line-number" value="977"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="978"></td><td class="line-content">                currentChatId = chatConfig.id;</td></tr><tr><td class="line-number" value="979"></td><td class="line-content">                const keys = await deriveKeysArgon2(chatConfig.savedPass, new TextEncoder().encode(chatConfig.id));</td></tr><tr><td class="line-number" value="980"></td><td class="line-content">                currentChatKey = keys.encKey;</td></tr><tr><td class="line-number" value="981"></td><td class="line-content">                currentSignKey = keys.sigKey;</td></tr><tr><td class="line-number" value="982"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="983"></td><td class="line-content">                const roomData = await loadFromNodes(currentChatId, currentChatKey);</td></tr><tr><td class="line-number" value="984"></td><td class="line-content">                if (roomData &amp;&amp; !roomData.isEmpty) {</td></tr><tr><td class="line-number" value="985"></td><td class="line-content">                    if (roomData.status === 'DELETED') {</td></tr><tr><td class="line-number" value="986"></td><td class="line-content">                        alert("Chat deleted by owner.");</td></tr><tr><td class="line-number" value="987"></td><td class="line-content">                        userChatList = userChatList.filter(c =&gt; c.id !== currentChatId);</td></tr><tr><td class="line-number" value="988"></td><td class="line-content">                        await saveToNodes('keychain', userChatList, masterKey);</td></tr><tr><td class="line-number" value="989"></td><td class="line-content">                        window.location.reload();</td></tr><tr><td class="line-number" value="990"></td><td class="line-content">                        return;</td></tr><tr><td class="line-number" value="991"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="992"></td><td class="line-content">                    chatData = roomData;</td></tr><tr><td class="line-number" value="993"></td><td class="line-content">                } else {</td></tr><tr><td class="line-number" value="994"></td><td class="line-content">                    chatData = { messages: [], lastActive: Date.now() };</td></tr><tr><td class="line-number" value="995"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="996"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="997"></td><td class="line-content">                if (sessionStorage.getItem('tamarto_handle')) {</td></tr><tr><td class="line-number" value="998"></td><td class="line-content">                    userHandle = sessionStorage.getItem('tamarto_handle');</td></tr><tr><td class="line-number" value="999"></td><td class="line-content">                    $('#handle-input').value = userHandle;</td></tr><tr><td class="line-number" value="1000"></td><td class="line-content">                    showChatInterface();</td></tr><tr><td class="line-number" value="1001"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="1002"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1003"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1004"></td><td class="line-content">            function showChatInterface() {</td></tr><tr><td class="line-number" value="1005"></td><td class="line-content">                $('#handle-container').style.display = 'none';</td></tr><tr><td class="line-number" value="1006"></td><td class="line-content">                $('#chat-container').style.display = 'flex';</td></tr><tr><td class="line-number" value="1007"></td><td class="line-content">                renderChat();</td></tr><tr><td class="line-number" value="1008"></td><td class="line-content">                startTimerLoop();</td></tr><tr><td class="line-number" value="1009"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1010"></td><td class="line-content">                // NEW: Start SSE Listeners instead of polling</td></tr><tr><td class="line-number" value="1011"></td><td class="line-content">                startSSEListeners(currentChatId);</td></tr><tr><td class="line-number" value="1012"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1013"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1014"></td><td class="line-content">            // --- SSE LISTENER LOGIC ---</td></tr><tr><td class="line-number" value="1015"></td><td class="line-content">            function startSSEListeners(recordId) {</td></tr><tr><td class="line-number" value="1016"></td><td class="line-content">                Logger.info("SSE: Initializing EventStreams...");</td></tr><tr><td class="line-number" value="1017"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1018"></td><td class="line-content">                NODES.forEach(node =&gt; {</td></tr><tr><td class="line-number" value="1019"></td><td class="line-content">                    const url = `${node.url}/api/listen?recordId=${recordId}&amp;token=${authToken}`;</td></tr><tr><td class="line-number" value="1020"></td><td class="line-content">                    // Note: EventSource does not support custom headers, hence token in URL</td></tr><tr><td class="line-number" value="1021"></td><td class="line-content">                    const source = new EventSource(url);</td></tr><tr><td class="line-number" value="1022"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1023"></td><td class="line-content">                    source.onmessage = async (event) =&gt; {</td></tr><tr><td class="line-number" value="1024"></td><td class="line-content">                        if (event.data === "UPDATE") {</td></tr><tr><td class="line-number" value="1025"></td><td class="line-content">                            Logger.info(`SSE: Update signal received from ${node.name}`);</td></tr><tr><td class="line-number" value="1026"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1027"></td><td class="line-content">                            // Trigger the standard load logic</td></tr><tr><td class="line-number" value="1028"></td><td class="line-content">                            const fresh = await loadFromNodes(currentChatId, currentChatKey);</td></tr><tr><td class="line-number" value="1029"></td><td class="line-content">                            if (fresh &amp;&amp; !fresh.isEmpty) {</td></tr><tr><td class="line-number" value="1030"></td><td class="line-content">                                if (JSON.stringify(fresh.messages) !== JSON.stringify(chatData.messages)) {</td></tr><tr><td class="line-number" value="1031"></td><td class="line-content">                                    chatData = fresh;</td></tr><tr><td class="line-number" value="1032"></td><td class="line-content">                                    renderChat();</td></tr><tr><td class="line-number" value="1033"></td><td class="line-content">                                    updateInactivityTimer();</td></tr><tr><td class="line-number" value="1034"></td><td class="line-content">                                }</td></tr><tr><td class="line-number" value="1035"></td><td class="line-content">                            }</td></tr><tr><td class="line-number" value="1036"></td><td class="line-content">                        }</td></tr><tr><td class="line-number" value="1037"></td><td class="line-content">                    };</td></tr><tr><td class="line-number" value="1038"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1039"></td><td class="line-content">                    source.onerror = (err) =&gt; {</td></tr><tr><td class="line-number" value="1040"></td><td class="line-content">                        // Silent fail for nodes that don't support SSE yet</td></tr><tr><td class="line-number" value="1041"></td><td class="line-content">                        // Browser handles reconnect automatically</td></tr><tr><td class="line-number" value="1042"></td><td class="line-content">                    };</td></tr><tr><td class="line-number" value="1043"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1044"></td><td class="line-content">                    activeEventSources.push(source);</td></tr><tr><td class="line-number" value="1045"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="1046"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1047"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1048"></td><td class="line-content">            async function renderChat() {</td></tr><tr><td class="line-number" value="1049"></td><td class="line-content">                const wrapper = $('#messages-wrapper');</td></tr><tr><td class="line-number" value="1050"></td><td class="line-content">                wrapper.innerHTML = '';</td></tr><tr><td class="line-number" value="1051"></td><td class="line-content">                chatData.messages.forEach(msg =&gt; {</td></tr><tr><td class="line-number" value="1052"></td><td class="line-content">                    const bubble = document.createElement('div');</td></tr><tr><td class="line-number" value="1053"></td><td class="line-content">                    const isMyMsg = msg.handle === userHandle;</td></tr><tr><td class="line-number" value="1054"></td><td class="line-content">                    bubble.className = `message-bubble ${isMyMsg ? 'sent' : 'received'}`;</td></tr><tr><td class="line-number" value="1055"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1056"></td><td class="line-content">                    let reactionsHtml = '';</td></tr><tr><td class="line-number" value="1057"></td><td class="line-content">                    if (msg.reactions &amp;&amp; Object.keys(msg.reactions).length &gt; 0) {</td></tr><tr><td class="line-number" value="1058"></td><td class="line-content">                        let inner = '';</td></tr><tr><td class="line-number" value="1059"></td><td class="line-content">                        Object.keys(msg.reactions).forEach(e =&gt; {</td></tr><tr><td class="line-number" value="1060"></td><td class="line-content">                            if (msg.reactions[e].length) inner += `&lt;span class="reaction-pill"&gt;${e} ${msg.reactions[e].length}&lt;/span&gt;`;</td></tr><tr><td class="line-number" value="1061"></td><td class="line-content">                        });</td></tr><tr><td class="line-number" value="1062"></td><td class="line-content">                        if (inner) reactionsHtml = `&lt;div class="reaction-container"&gt;${inner}&lt;/div&gt;`;</td></tr><tr><td class="line-number" value="1063"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="1064"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1065"></td><td class="line-content">                    const formattedBody = formatMessageText(msg.text);</td></tr><tr><td class="line-number" value="1066"></td><td class="line-content">                    bubble.innerHTML = `</td></tr><tr><td class="line-number" value="1067"></td><td class="line-content">                            &lt;div class="message-meta"&gt;${msg.handle}&lt;/div&gt;</td></tr><tr><td class="line-number" value="1068"></td><td class="line-content">                            &lt;div&gt;${formattedBody}&lt;/div&gt;</td></tr><tr><td class="line-number" value="1069"></td><td class="line-content">                            &lt;div class="message-time"&gt;${new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}&lt;/div&gt;</td></tr><tr><td class="line-number" value="1070"></td><td class="line-content">                            ${reactionsHtml}</td></tr><tr><td class="line-number" value="1071"></td><td class="line-content">                        `;</td></tr><tr><td class="line-number" value="1072"></td><td class="line-content">                    bubble.onclick = (e) =&gt; {</td></tr><tr><td class="line-number" value="1073"></td><td class="line-content">                        if (e.target.tagName === 'A') return;</td></tr><tr><td class="line-number" value="1074"></td><td class="line-content">                        pendingActionMsgId = msg.id;</td></tr><tr><td class="line-number" value="1075"></td><td class="line-content">                        $('#msg-opt-delete').style.display = isMyMsg ? 'flex' : 'none';</td></tr><tr><td class="line-number" value="1076"></td><td class="line-content">                        $('#message-options-modal').style.display = 'flex';</td></tr><tr><td class="line-number" value="1077"></td><td class="line-content">                    };</td></tr><tr><td class="line-number" value="1078"></td><td class="line-content">                    wrapper.appendChild(bubble);</td></tr><tr><td class="line-number" value="1079"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="1080"></td><td class="line-content">                $('#chat-messages-container').scrollTop = $('#chat-messages-container').scrollHeight;</td></tr><tr><td class="line-number" value="1081"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1082"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1083"></td><td class="line-content">            // --- LISTENERS ---</td></tr><tr><td class="line-number" value="1084"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1085"></td><td class="line-content">            // 1. Back Button Listener (UPDATED to close SSE)</td></tr><tr><td class="line-number" value="1086"></td><td class="line-content">            $('#back-to-lobby-btn').addEventListener('click', () =&gt; {</td></tr><tr><td class="line-number" value="1087"></td><td class="line-content">                if (timerInterval) clearInterval(timerInterval);</td></tr><tr><td class="line-number" value="1088"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1089"></td><td class="line-content">                // Cleanup SSE connections</td></tr><tr><td class="line-number" value="1090"></td><td class="line-content">                activeEventSources.forEach(src =&gt; src.close());</td></tr><tr><td class="line-number" value="1091"></td><td class="line-content">                activeEventSources = [];</td></tr><tr><td class="line-number" value="1092"></td><td class="line-content">                Logger.info("SSE: Connections closed.");</td></tr><tr><td class="line-number" value="1093"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1094"></td><td class="line-content">                $('#chat-app').style.display = 'none';</td></tr><tr><td class="line-number" value="1095"></td><td class="line-content">                $('#back-to-lobby-btn').style.display = 'none';</td></tr><tr><td class="line-number" value="1096"></td><td class="line-content">                $('#lobby-container').style.display = 'block';</td></tr><tr><td class="line-number" value="1097"></td><td class="line-content">                currentChatKey = null;</td></tr><tr><td class="line-number" value="1098"></td><td class="line-content">                currentSignKey = null;</td></tr><tr><td class="line-number" value="1099"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1100"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1101"></td><td class="line-content">            // 2. Burger Menu Listeners</td></tr><tr><td class="line-number" value="1102"></td><td class="line-content">            const burgerBtn = $('#burger-btn');</td></tr><tr><td class="line-number" value="1103"></td><td class="line-content">            const menuDropdown = $('#menu-dropdown');</td></tr><tr><td class="line-number" value="1104"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1105"></td><td class="line-content">            burgerBtn.addEventListener('click', (e) =&gt; {</td></tr><tr><td class="line-number" value="1106"></td><td class="line-content">                e.stopPropagation();</td></tr><tr><td class="line-number" value="1107"></td><td class="line-content">                menuDropdown.classList.toggle('show');</td></tr><tr><td class="line-number" value="1108"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1109"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1110"></td><td class="line-content">            document.addEventListener('click', (e) =&gt; {</td></tr><tr><td class="line-number" value="1111"></td><td class="line-content">                if (!menuDropdown.contains(e.target) &amp;&amp; !burgerBtn.contains(e.target)) {</td></tr><tr><td class="line-number" value="1112"></td><td class="line-content">                    menuDropdown.classList.remove('show');</td></tr><tr><td class="line-number" value="1113"></td><td class="line-content">                }</td></tr><tr><td class="line-number" value="1114"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1115"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1116"></td><td class="line-content">            // 3. Message Options &amp; Deletion</td></tr><tr><td class="line-number" value="1117"></td><td class="line-content">            const messageOptionsModal = $('#message-options-modal');</td></tr><tr><td class="line-number" value="1118"></td><td class="line-content">            messageOptionsModal.addEventListener('click', (e) =&gt; {</td></tr><tr><td class="line-number" value="1119"></td><td class="line-content">                if (e.target === messageOptionsModal) messageOptionsModal.style.display = 'none';</td></tr><tr><td class="line-number" value="1120"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1121"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1122"></td><td class="line-content">            $$('.emoji-opt').forEach(btn =&gt; {</td></tr><tr><td class="line-number" value="1123"></td><td class="line-content">                btn.addEventListener('click', async () =&gt; {</td></tr><tr><td class="line-number" value="1124"></td><td class="line-content">                    const emoji = btn.getAttribute('data-emoji');</td></tr><tr><td class="line-number" value="1125"></td><td class="line-content">                    const msg = chatData.messages.find(m =&gt; m.id === pendingActionMsgId);</td></tr><tr><td class="line-number" value="1126"></td><td class="line-content">                    if (msg) {</td></tr><tr><td class="line-number" value="1127"></td><td class="line-content">                        if (!msg.reactions) msg.reactions = {};</td></tr><tr><td class="line-number" value="1128"></td><td class="line-content">                        if (!msg.reactions[emoji]) msg.reactions[emoji] = [];</td></tr><tr><td class="line-number" value="1129"></td><td class="line-content">                        const idx = msg.reactions[emoji].indexOf(userHandle);</td></tr><tr><td class="line-number" value="1130"></td><td class="line-content">                        if (idx &gt; -1) msg.reactions[emoji].splice(idx, 1);</td></tr><tr><td class="line-number" value="1131"></td><td class="line-content">                        else msg.reactions[emoji].push(userHandle);</td></tr><tr><td class="line-number" value="1132"></td><td class="line-content">                        chatData.lastActive = Date.now();</td></tr><tr><td class="line-number" value="1133"></td><td class="line-content">                        renderChat();</td></tr><tr><td class="line-number" value="1134"></td><td class="line-content">                        messageOptionsModal.style.display = 'none';</td></tr><tr><td class="line-number" value="1135"></td><td class="line-content">                        await saveToNodes(currentChatId, chatData, currentChatKey);</td></tr><tr><td class="line-number" value="1136"></td><td class="line-content">                    }</td></tr><tr><td class="line-number" value="1137"></td><td class="line-content">                });</td></tr><tr><td class="line-number" value="1138"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1139"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1140"></td><td class="line-content">            $('#msg-opt-delete').addEventListener('click', () =&gt; {</td></tr><tr><td class="line-number" value="1141"></td><td class="line-content">                messageOptionsModal.style.display = 'none';</td></tr><tr><td class="line-number" value="1142"></td><td class="line-content">                $('#delete-modal').style.display = 'flex';</td></tr><tr><td class="line-number" value="1143"></td><td class="line-content">                $('#confirm-delete-btn').onclick = async () =&gt; {</td></tr><tr><td class="line-number" value="1144"></td><td class="line-content">                    chatData.messages = chatData.messages.filter(m =&gt; m.id !== pendingActionMsgId);</td></tr><tr><td class="line-number" value="1145"></td><td class="line-content">                    $('#delete-modal').style.display = 'none';</td></tr><tr><td class="line-number" value="1146"></td><td class="line-content">                    renderChat();</td></tr><tr><td class="line-number" value="1147"></td><td class="line-content">                    await saveToNodes(currentChatId, chatData, currentChatKey);</td></tr><tr><td class="line-number" value="1148"></td><td class="line-content">                };</td></tr><tr><td class="line-number" value="1149"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1150"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1151"></td><td class="line-content">            // 4. Forms</td></tr><tr><td class="line-number" value="1152"></td><td class="line-content">            $('#chat-form').addEventListener('submit', async (e) =&gt; {</td></tr><tr><td class="line-number" value="1153"></td><td class="line-content">                e.preventDefault();</td></tr><tr><td class="line-number" value="1154"></td><td class="line-content">                const input = $('#message-input');</td></tr><tr><td class="line-number" value="1155"></td><td class="line-content">                const text = input.value.trim();</td></tr><tr><td class="line-number" value="1156"></td><td class="line-content">                if (!text) return;</td></tr><tr><td class="line-number" value="1157"></td><td class="line-content">                const payload = {</td></tr><tr><td class="line-number" value="1158"></td><td class="line-content">                    id: Date.now(),</td></tr><tr><td class="line-number" value="1159"></td><td class="line-content">                    nonce: crypto.randomUUID(),</td></tr><tr><td class="line-number" value="1160"></td><td class="line-content">                    handle: userHandle,</td></tr><tr><td class="line-number" value="1161"></td><td class="line-content">                    text: text,</td></tr><tr><td class="line-number" value="1162"></td><td class="line-content">                    timestamp: new Date().toISOString(),</td></tr><tr><td class="line-number" value="1163"></td><td class="line-content">                    reactions: {}</td></tr><tr><td class="line-number" value="1164"></td><td class="line-content">                };</td></tr><tr><td class="line-number" value="1165"></td><td class="line-content">                const signature = await signMessage(payload, currentSignKey);</td></tr><tr><td class="line-number" value="1166"></td><td class="line-content">                chatData.messages.push({ ...payload, signature });</td></tr><tr><td class="line-number" value="1167"></td><td class="line-content">                chatData.lastActive = Date.now();</td></tr><tr><td class="line-number" value="1168"></td><td class="line-content">                input.value = '';</td></tr><tr><td class="line-number" value="1169"></td><td class="line-content">                renderChat();</td></tr><tr><td class="line-number" value="1170"></td><td class="line-content">                await saveToNodes(currentChatId, chatData, currentChatKey);</td></tr><tr><td class="line-number" value="1171"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1172"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1173"></td><td class="line-content">            $('#delete-chat-btn').addEventListener('click', () =&gt; {</td></tr><tr><td class="line-number" value="1174"></td><td class="line-content">                $('#delete-modal').style.display = 'flex';</td></tr><tr><td class="line-number" value="1175"></td><td class="line-content">                $('#confirm-delete-btn').onclick = async () =&gt; {</td></tr><tr><td class="line-number" value="1176"></td><td class="line-content">                    Logger.info("System: Deleting chat permanently...");</td></tr><tr><td class="line-number" value="1177"></td><td class="line-content">                    chatData.messages = [];</td></tr><tr><td class="line-number" value="1178"></td><td class="line-content">                    chatData.status = 'DELETED';</td></tr><tr><td class="line-number" value="1179"></td><td class="line-content">                    await saveToNodes(currentChatId, chatData, currentChatKey);</td></tr><tr><td class="line-number" value="1180"></td><td class="line-content">                    userChatList = userChatList.filter(c =&gt; c.id !== currentChatId);</td></tr><tr><td class="line-number" value="1181"></td><td class="line-content">                    await saveToNodes('keychain', userChatList, masterKey);</td></tr><tr><td class="line-number" value="1182"></td><td class="line-content">                    window.location.reload();</td></tr><tr><td class="line-number" value="1183"></td><td class="line-content">                };</td></tr><tr><td class="line-number" value="1184"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1185"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1186"></td><td class="line-content">            $('#unlock-form').addEventListener('submit', (e) =&gt; { e.preventDefault(); unlockHub($('#master-password').value); });</td></tr><tr><td class="line-number" value="1187"></td><td class="line-content">            $('#create-chat-form').addEventListener('submit', (e) =&gt; { e.preventDefault(); createNewChat(); });</td></tr><tr><td class="line-number" value="1188"></td><td class="line-content">            $('#join-chat-form').addEventListener('submit', (e) =&gt; { e.preventDefault(); joinExternalChat(); });</td></tr><tr><td class="line-number" value="1189"></td><td class="line-content">            $('#handle-form').addEventListener('submit', (e) =&gt; {</td></tr><tr><td class="line-number" value="1190"></td><td class="line-content">                e.preventDefault();</td></tr><tr><td class="line-number" value="1191"></td><td class="line-content">                userHandle = $('#handle-input').value.trim() || 'Guest';</td></tr><tr><td class="line-number" value="1192"></td><td class="line-content">                sessionStorage.setItem('tamarto_handle', userHandle);</td></tr><tr><td class="line-number" value="1193"></td><td class="line-content">                showChatInterface();</td></tr><tr><td class="line-number" value="1194"></td><td class="line-content">            });</td></tr><tr><td class="line-number" value="1195"></td><td class="line-content">            $('#open-create-modal-btn').onclick = () =&gt; $('#create-modal').style.display = 'flex';</td></tr><tr><td class="line-number" value="1196"></td><td class="line-content">            $('#toggle-dark-mode').onclick = () =&gt; document.body.classList.toggle('dark-mode');</td></tr><tr><td class="line-number" value="1197"></td><td class="line-content">            $('#copy-invite-link').onclick = () =&gt; {</td></tr><tr><td class="line-number" value="1198"></td><td class="line-content">                const link = `${window.location.origin}${window.location.pathname}?join=${currentChatId}`;</td></tr><tr><td class="line-number" value="1199"></td><td class="line-content">                navigator.clipboard.writeText(link).then(() =&gt; alert("Copied!"));</td></tr><tr><td class="line-number" value="1200"></td><td class="line-content">            };</td></tr><tr><td class="line-number" value="1201"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1202"></td><td class="line-content">            // 5. Init</td></tr><tr><td class="line-number" value="1203"></td><td class="line-content">            Logger.log("Tamarto Hub Loaded");</td></tr><tr><td class="line-number" value="1204"></td><td class="line-content">            if (window.location.hash.includes('token=')) {</td></tr><tr><td class="line-number" value="1205"></td><td class="line-content">                authToken = window.location.hash.split('token=')[1];</td></tr><tr><td class="line-number" value="1206"></td><td class="line-content">                window.history.replaceState(null, null, window.location.pathname);</td></tr><tr><td class="line-number" value="1207"></td><td class="line-content">                $('#connection-status').textContent = "Ready";</td></tr><tr><td class="line-number" value="1208"></td><td class="line-content">                Logger.info("Auth Token Found");</td></tr><tr><td class="line-number" value="1209"></td><td class="line-content">            } else {</td></tr><tr><td class="line-number" value="1210"></td><td class="line-content">                setTimeout(() =&gt; window.location.href = 'https://auth.loktd.com/c/tamarto', 1000);</td></tr><tr><td class="line-number" value="1211"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1212"></td><td class="line-content">            if (new URLSearchParams(window.location.search).get('join')) {</td></tr><tr><td class="line-number" value="1213"></td><td class="line-content">                $('#join-id-input').value = new URLSearchParams(window.location.search).get('join');</td></tr><tr><td class="line-number" value="1214"></td><td class="line-content">                Logger.log("Join Detected from URL");</td></tr><tr><td class="line-number" value="1215"></td><td class="line-content">            }</td></tr><tr><td class="line-number" value="1216"></td><td class="line-content">        });</td></tr><tr><td class="line-number" value="1217"></td><td class="line-content">    <span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1218"></td><td class="line-content"><span class="html-tag">&lt;/body&gt;</span></td></tr><tr><td class="line-number" value="1219"></td><td class="line-content"><span class="html-tag">&lt;/html&gt;</span><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>